!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bundle=e()}}(function(){return function i(a,s,u){function c(n,e){if(!s[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(l)return l(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var o=s[n]={exports:{}};a[n][0].call(o.exports,function(e){return c(a[n][1][e]||e)},o,o.exports,i,a,s,u)}return s[n].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,n,t){var r=function(e){var c="b",l="w",u=-1,y="p",w="n",k="b",P="r",E="q",f="k",r="pnbrqkPNBRQK",n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",v=["1-0","0-1","1/2-1/2","*"],C={b:[16,32,17,15],w:[-16,-32,-17,-15]},A={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},d=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],p=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],h={p:0,n:1,b:2,r:3,q:4,k:5},o={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},_={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},S=7,O=6,T=1,x=0,M={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},g={w:[{square:M.a1,flag:_.QSIDE_CASTLE},{square:M.h1,flag:_.KSIDE_CASTLE}],b:[{square:M.a8,flag:_.QSIDE_CASTLE},{square:M.h8,flag:_.KSIDE_CASTLE}]},L=new Array(128),I={w:u,b:u},N=l,D={w:0,b:0},j=u,m=0,b=1,R=[],q={};function s(){L=new Array(128),I={w:u,b:u},N=l,D={w:0,b:0},j=u,m=0,b=1,R=[],q={},W(z())}function K(){U(n)}function U(e){var n=e.split(/\s+/),t=n[0],r=0;if(!B(e).valid)return!1;s();for(var o=0;o<t.length;o++){var i=t.charAt(o);if("/"===i)r+=8;else if(-1!=="0123456789".indexOf(i))r+=parseInt(i,10);else{var a=i<"a"?l:c;F({type:i.toLowerCase(),color:a},ae(r)),r++}}return N=n[1],-1<n[2].indexOf("K")&&(D.w|=_.KSIDE_CASTLE),-1<n[2].indexOf("Q")&&(D.w|=_.QSIDE_CASTLE),-1<n[2].indexOf("k")&&(D.b|=_.KSIDE_CASTLE),-1<n[2].indexOf("q")&&(D.b|=_.QSIDE_CASTLE),j="-"===n[3]?u:M[n[3]],m=parseInt(n[4],10),b=parseInt(n[5],10),W(z()),!0}function B(e){var n="No errors.",t="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",a="3rd field (castling availability) is invalid.",s="2nd field (side to move) is invalid.",u="1st field (piece positions) does not contain 8 '/'-delimited rows.",c="1st field (piece positions) is invalid [consecutive numbers].",l="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",d="Illegal en-passant square",p=e.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:t};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:a};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:s};var v=p[0].split("/");if(8!==v.length)return{valid:!1,error_number:7,error:u};for(var h=0;h<v.length;h++){for(var g=0,m=!1,b=0;b<v[h].length;b++)if(isNaN(v[h][b])){if(!/^[prnbqkPRNBQK]$/.test(v[h][b]))return{valid:!1,error_number:9,error:l};g+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:c};g+=parseInt(v[h][b],10),m=!0}if(8!==g)return{valid:!1,error_number:10,error:f}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:d}:{valid:!0,error_number:0,error:n}}function z(){for(var e=0,n="",t=M.a8;t<=M.h1;t++){if(null==L[t])e++;else{0<e&&(n+=e,e=0);var r=L[t].color,o=L[t].type;n+=r===l?o.toUpperCase():o.toLowerCase()}t+1&136&&(0<e&&(n+=e),t!==M.h1&&(n+="/"),e=0,t+=8)}var i="";D[l]&_.KSIDE_CASTLE&&(i+="K"),D[l]&_.QSIDE_CASTLE&&(i+="Q"),D[c]&_.KSIDE_CASTLE&&(i+="k"),D[c]&_.QSIDE_CASTLE&&(i+="q"),i=i||"-";var a=j===u?"-":ae(j);return[n,N,i,a,m,b].join(" ")}function Q(e){for(var n=0;n<e.length;n+=2)"string"==typeof e[n]&&"string"==typeof e[n+1]&&(q[e[n]]=e[n+1]);return q}function W(e){0<R.length||(e!==n?(q.SetUp="1",q.FEN=e):(delete q.SetUp,delete q.FEN))}function i(e){var n=L[M[e]];return n?{type:n.type,color:n.color}:null}function F(e,n){if(!("type"in e&&"color"in e))return!1;if(-1===r.indexOf(e.type.toLowerCase()))return!1;if(!(n in M))return!1;var t=M[n];return(e.type!=f||I[e.color]==u||I[e.color]==t)&&(L[t]={type:e.type,color:e.color},e.type===f&&(I[e.color]=t),W(z()),!0)}function $(e,n,t,r,o){var i={color:N,from:n,to:t,flags:r,piece:e[n].type};return o&&(i.flags|=_.PROMOTION,i.promotion=o),e[t]?i.captured=e[t].type:r&_.EP_CAPTURE&&(i.captured=y),i}function H(e){function n(e,n,t,r,o){if(e[t].type!==y||oe(r)!==x&&oe(r)!==S)n.push($(e,t,r,o));else for(var i=[E,P,k,w],a=0,s=i.length;a<s;a++)n.push($(e,t,r,o,i[a]))}var t=[],r=N,o=se(r),i={b:T,w:O},a=M.a8,s=M.h1,u=!1,c=!(void 0!==e&&"legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in M))return[];a=s=M[e.square],u=!0}for(var l=a;l<=s;l++)if(136&l)l+=7;else{var f=L[l];if(null!=f&&f.color===r)if(f.type===y){var d=l+C[r][0];if(null==L[d]){n(L,t,l,d,_.NORMAL);d=l+C[r][1];i[r]===oe(l)&&null==L[d]&&n(L,t,l,d,_.BIG_PAWN)}for(p=2;p<4;p++){136&(d=l+C[r][p])||(null!=L[d]&&L[d].color===o?n(L,t,l,d,_.CAPTURE):d===j&&n(L,t,l,j,_.EP_CAPTURE))}}else for(var p=0,v=A[f.type].length;p<v;p++){var h=A[f.type][p];for(d=l;!(136&(d+=h));){if(null!=L[d]){if(L[d].color===r)break;n(L,t,l,d,_.CAPTURE);break}if(n(L,t,l,d,_.NORMAL),"n"===f.type||"k"===f.type)break}}}if(!u||s===I[r]){if(D[r]&_.KSIDE_CASTLE){var g=(m=I[r])+2;null!=L[m+1]||null!=L[g]||Z(o,I[r])||Z(o,m+1)||Z(o,g)||n(L,t,I[r],g,_.KSIDE_CASTLE)}if(D[r]&_.QSIDE_CASTLE){var m;g=(m=I[r])-2;null!=L[m-1]||null!=L[m-2]||null!=L[m-3]||Z(o,I[r])||Z(o,m-1)||Z(o,g)||n(L,t,I[r],g,_.QSIDE_CASTLE)}}if(!c)return t;var b=[];for(l=0,v=t.length;l<v;l++)ne(t[l]),V(r)||b.push(t[l]),te();return b}function G(e,n){var t="";if(e.flags&_.KSIDE_CASTLE)t="O-O";else if(e.flags&_.QSIDE_CASTLE)t="O-O-O";else{var r=function(e,n){for(var t=H({legal:!n}),r=e.from,o=e.to,i=e.piece,a=0,s=0,u=0,c=0,l=t.length;c<l;c++){var f=t[c].from,d=t[c].to,p=t[c].piece;i===p&&r!==f&&o===d&&(a++,oe(r)===oe(f)&&s++,ie(r)===ie(f)&&u++)}if(0<a)return 0<s&&0<u?ae(r):0<u?ae(r).charAt(1):ae(r).charAt(0);return""}(e,n);e.piece!==y&&(t+=e.piece.toUpperCase()+r),e.flags&(_.CAPTURE|_.EP_CAPTURE)&&(e.piece===y&&(t+=ae(e.from)[0]),t+="x"),t+=ae(e.to),e.flags&_.PROMOTION&&(t+="="+e.promotion.toUpperCase())}return ne(e),a()&&(Y()?t+="#":t+="+"),te(),t}function X(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Z(e,n){for(var t=M.a8;t<=M.h1;t++)if(136&t)t+=7;else if(null!=L[t]&&L[t].color===e){var r=L[t],o=t-n,i=o+119;if(d[i]&1<<h[r.type]){if(r.type===y){if(0<o){if(r.color===l)return!0}else if(r.color===c)return!0;continue}if("n"===r.type||"k"===r.type)return!0;for(var a=p[i],s=t+a,u=!1;s!==n;){if(null!=L[s]){u=!0;break}s+=a}if(!u)return!0}}return!1}function V(e){return Z(se(e),I[e])}function a(){return V(N)}function Y(){return a()&&0===H().length}function t(){return!a()&&0===H().length}function J(){for(var e={},n=[],t=0,r=0,o=M.a8;o<=M.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var i=L[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===k&&n.push(r),t++)}if(2===t)return!0;if(3===t&&(1===e[k]||1===e[w]))return!0;if(t===e[k]+2){var a=0,s=n.length;for(o=0;o<s;o++)a+=n[o];if(0===a||a===s)return!0}return!1}function ee(){for(var e=[],n={},t=!1;;){var r=te();if(!r)break;e.push(r)}for(;;){var o=z().split(" ").slice(0,4).join(" ");if(n[o]=o in n?n[o]+1:1,3<=n[o]&&(t=!0),!e.length)break;ne(e.pop())}return t}function ne(e){var n,t=N,r=se(t);if(n=e,R.push({move:n,kings:{b:I.b,w:I.w},turn:N,castling:{b:D.b,w:D.w},ep_square:j,half_moves:m,move_number:b}),L[e.to]=L[e.from],L[e.from]=null,e.flags&_.EP_CAPTURE&&(N===c?L[e.to-16]=null:L[e.to+16]=null),e.flags&_.PROMOTION&&(L[e.to]={type:e.promotion,color:t}),L[e.to].type===f){if(I[L[e.to].color]=e.to,e.flags&_.KSIDE_CASTLE){var o=e.to-1,i=e.to+1;L[o]=L[i],L[i]=null}else if(e.flags&_.QSIDE_CASTLE){o=e.to+1,i=e.to-2;L[o]=L[i],L[i]=null}D[t]=""}if(D[t])for(var a=0,s=g[t].length;a<s;a++)if(e.from===g[t][a].square&&D[t]&g[t][a].flag){D[t]^=g[t][a].flag;break}if(D[r])for(a=0,s=g[r].length;a<s;a++)if(e.to===g[r][a].square&&D[r]&g[r][a].flag){D[r]^=g[r][a].flag;break}j=e.flags&_.BIG_PAWN?"b"===N?e.to-16:e.to+16:u,e.piece===y?m=0:e.flags&(_.CAPTURE|_.EP_CAPTURE)?m=0:m++,N===c&&b++,N=se(N)}function te(){var e=R.pop();if(null==e)return null;var n=e.move;I=e.kings,N=e.turn,D=e.castling,j=e.ep_square,m=e.half_moves,b=e.move_number;var t,r,o=N,i=se(N);if(L[n.from]=L[n.to],L[n.from].type=n.piece,L[n.to]=null,n.flags&_.CAPTURE)L[n.to]={type:n.captured,color:i};else if(n.flags&_.EP_CAPTURE){var a;a=o===c?n.to-16:n.to+16,L[a]={type:y,color:i}}n.flags&(_.KSIDE_CASTLE|_.QSIDE_CASTLE)&&(n.flags&_.KSIDE_CASTLE?(t=n.to+1,r=n.to-1):n.flags&_.QSIDE_CASTLE&&(t=n.to-2,r=n.to+1),L[t]=L[r],L[r]=null);return n}function re(e,n){var t=X(e);if(n){var r=t.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(r)var o=r[1],i=r[2],a=r[3],s=r[4]}for(var u=H(),c=0,l=u.length;c<l;c++){if(t===X(G(u[c]))||n&&t===X(G(u[c],!0)))return u[c];if(r&&(!o||o.toLowerCase()==u[c].piece)&&M[i]==u[c].from&&M[a]==u[c].to&&(!s||s.toLowerCase()==u[c].promotion))return u[c]}return null}function oe(e){return e>>4}function ie(e){return 15&e}function ae(e){var n=ie(e),t=oe(e);return"abcdefgh".substring(n,n+1)+"87654321".substring(t,t+1)}function se(e){return e===l?c:l}function ue(e){var n=function e(n){var t=n instanceof Array?[]:{};for(var r in n)t[r]="object"==typeof r?e(n[r]):n[r];return t}(e);n.san=G(n,!1),n.to=ae(n.to),n.from=ae(n.from);var t="";for(var r in _)_[r]&n.flags&&(t+=o[r]);return n.flags=t,n}function ce(e){return e.replace(/^\s+|\s+$/g,"")}return U(void 0===e?n:e),{WHITE:l,BLACK:c,PAWN:y,KNIGHT:w,BISHOP:k,ROOK:P,QUEEN:E,KING:f,SQUARES:function(){for(var e=[],n=M.a8;n<=M.h1;n++)136&n?n+=7:e.push(ae(n));return e}(),FLAGS:o,load:function(e){return U(e)},reset:function(){return K()},moves:function(e){for(var n=H(e),t=[],r=0,o=n.length;r<o;r++)void 0!==e&&"verbose"in e&&e.verbose?t.push(ue(n[r])):t.push(G(n[r],!1));return t},in_check:function(){return a()},in_checkmate:function(){return Y()},in_stalemate:function(){return t()},in_draw:function(){return 100<=m||t()||J()||ee()},insufficient_material:function(){return J()},in_threefold_repetition:function(){return ee()},game_over:function(){return 100<=m||Y()||t()||J()||ee()},validate_fen:function(e){return B(e)},fen:function(){return z()},pgn:function(e){var n="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",t="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],o=!1;for(var i in q)r.push("["+i+' "'+q[i]+'"]'+n),o=!0;o&&R.length&&r.push(n);for(var a=[];0<R.length;)a.push(te());for(var s=[],u="";0<a.length;){var c=a.pop();R.length||"b"!==c.color?"w"===c.color&&(u.length&&s.push(u),u=b+"."):u=b+". ...",u=u+" "+G(c,!1),ne(c)}if(u.length&&s.push(u),void 0!==q.Result&&s.push(q.Result),0===t)return r.join("")+s.join(" ");var l=0;for(i=0;i<s.length;i++)l+s[i].length>t&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(n),l=0):0!==i&&(r.push(" "),l++),r.push(s[i]),l+=s[i].length;return r.join("")},load_pgn:function(e,n){var t=void 0!==n&&"sloppy"in n&&n.sloppy;function u(e){return e.replace(/\\/g,"\\")}var r="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",o=new RegExp("^(\\[(.|"+u(r)+")*\\])("+u(r)+")*1.("+u(r)+"|.)*$","g"),i=e.replace(o,"$1");"["!==i[0]&&(i=""),K();var a=function(e,n){for(var t="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",r={},o=e.split(new RegExp(u(t))),i="",a="",s=0;s<o.length;s++)i=o[s].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),a=o[s].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),0<ce(i).length&&(r[i]=a);return r}(i,n);for(var s in a)Q([s,a[s]]);if("1"===a.SetUp&&!("FEN"in a&&U(a.FEN)))return!1;var c=e.replace(i,"").replace(new RegExp(u(r),"g")," ");c=c.replace(/(\{[^}]+\})+?/g,"");for(var l=/(\([^\(\)]+\))+?/g;l.test(c);)c=c.replace(l,"");var f=ce(c=(c=(c=c.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));f=f.join(",").replace(/,,+/g,",").split(",");for(var d="",p=0;p<f.length-1;p++){if(null==(d=re(f[p],t)))return!1;ne(d)}if(d=f[f.length-1],-1<v.indexOf(d))(function(e){for(var n in e)return!0;return!1})(q)&&void 0===q.Result&&Q(["Result",d]);else{if(null==(d=re(d,t)))return!1;ne(d)}return!0},header:function(){return Q(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",n=M.a8;n<=M.h1;n++){if(0===ie(n)&&(e+=" "+"87654321"[oe(n)]+" |"),null==L[n])e+=" . ";else{var t=L[n].type;e+=" "+(L[n].color===l?t.toUpperCase():t.toLowerCase())+" "}n+1&136&&(e+="|\n",n+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return N},move:function(e,n){var t=void 0!==n&&"sloppy"in n&&n.sloppy,r=null;if("string"==typeof e)r=re(e,t);else if("object"==typeof e)for(var o=H(),i=0,a=o.length;i<a;i++)if(!(e.from!==ae(o[i].from)||e.to!==ae(o[i].to)||"promotion"in o[i]&&e.promotion!==o[i].promotion)){r=o[i];break}if(!r)return null;var s=ue(r);return ne(r),s},undo:function(){var e=te();return e?ue(e):null},clear:function(){return s()},put:function(e,n){return F(e,n)},get:function(e){return i(e)},remove:function(e){return t=i(n=e),L[M[n]]=null,t&&t.type===f&&(I[t.color]=u),W(z()),t;var n,t},perft:function(e){return function e(n){for(var t=H({legal:!1}),r=0,o=N,i=0,a=t.length;i<a;i++)ne(t[i]),V(o)||(0<n-1?r+=e(n-1):r++),te();return r}(e)},square_color:function(e){if(e in M){var n=M[e];return(oe(n)+ie(n))%2==0?"light":"dark"}return null},history:function(e){for(var n=[],t=[],r=(void 0!==e&&"verbose"in e&&e.verbose);0<R.length;)n.push(te());for(;0<n.length;){var o=n.pop();r?t.push(ue(o)):t.push(G(o)),ne(o)}return t}}};void 0!==t&&(t.Chess=r)},{}],2:[function(e,n,t){"use strict";var a=this&&this.__assign||Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var h=e("./util");function r(e,n){var t=e(n);return n.dom.redraw(),t}function g(e,n){return{key:e,pos:h.key2pos(e),piece:n}}t.anim=function(e,n){return n.animation.enabled?function(e,n){var t=a({},n.pieces),r=e(n),o=function(e,n){var t,r,o,i,a={},s=[],u={},c=[],l=[],f={};for(o in e)f[o]=g(o,e[o]);for(var d=0,p=h.allKeys;d<p.length;d++){var v=p[d];t=n.pieces[v],r=f[v],t?r?h.samePiece(t,r.piece)||(c.push(r),l.push(g(v,t))):l.push(g(v,t)):r&&c.push(r)}return l.forEach(function(n){var t,e;t=n,e=c.filter(function(e){return h.samePiece(n.piece,e.piece)}),(r=e.sort(function(e,n){return h.distanceSq(t.pos,e.pos)-h.distanceSq(t.pos,n.pos)})[0])&&(i=[r.pos[0]-n.pos[0],r.pos[1]-n.pos[1]],a[n.key]=i.concat(i),s.push(r.key))}),c.forEach(function(e){h.containsX(s,e.key)||n.items&&n.items(e.pos,e.key)||(u[e.key]=e.piece)}),{anims:a,fadings:u}}(t,n);if(s(o.anims)&&s(o.fadings))n.dom.redraw();else{var i=n.animation.current&&n.animation.current.start;n.animation.current={start:c.now(),frequency:1/n.animation.duration,plan:o},i||function n(t,e){var r=t.animation.current;if(void 0!==r){var o,i=1-(e-r.start)*r.frequency;if(i<=0)t.animation.current=void 0,t.dom.redrawNow();else{var a=(o=i)<.5?4*o*o*o:(o-1)*(2*o-2)*(2*o-2)+1;for(var s in r.plan.anims){var u=r.plan.anims[s];u[2]=u[0]*a,u[3]=u[1]*a}t.dom.redrawNow(!0),h.raf(function(e){return void 0===e&&(e=c.now()),n(t,e)})}}else t.dom.destroyed||t.dom.redrawNow()}(n,c.now())}return r}(e,n):r(e,n)},t.render=r;var c=void 0!==window.performance?window.performance:Date;function s(e){for(var n in e)return!1;return!0}},{"./util":17}],3:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./board"),i=e("./fen"),a=e("./config"),s=e("./anim"),u=e("./drag"),c=e("./explosion");t.start=function(r,e){function t(){o.toggleOrientation(r),e()}return{set:function(n){n.orientation&&n.orientation!==r.orientation&&t(),(n.fen?s.anim:s.render)(function(e){return a.configure(e,n)},r)},state:r,getFen:function(){return i.write(r.pieces)},toggleOrientation:t,setPieces:function(n){s.anim(function(e){return o.setPieces(e,n)},r)},selectSquare:function(n,t){n?s.anim(function(e){return o.selectSquare(e,n,t)},r):r.selected&&(o.unselect(r),r.dom.redraw())},move:function(n,t){s.anim(function(e){return o.baseMove(e,n,t)},r)},newPiece:function(n,t){s.anim(function(e){return o.baseNewPiece(e,n,t)},r)},playPremove:function(){if(r.premovable.current){if(s.anim(o.playPremove,r))return!0;r.dom.redraw()}return!1},playPredrop:function(e){if(r.predroppable.current){var n=o.playPredrop(r,e);return r.dom.redraw(),n}return!1},cancelPremove:function(){s.render(o.unsetPremove,r)},cancelPredrop:function(){s.render(o.unsetPredrop,r)},cancelMove:function(){s.render(function(e){o.cancelMove(e),u.cancel(e)},r)},stop:function(){s.render(function(e){o.stop(e),u.cancel(e)},r)},explode:function(e){c.default(r,e)},setAutoShapes:function(n){s.render(function(e){return e.drawable.autoShapes=n},r)},setShapes:function(n){s.render(function(e){return e.drawable.shapes=n},r)},getKeyAtDomPos:function(e){return o.getKeyAtDomPos(e,"white"===r.orientation,r.dom.bounds())},redrawAll:e,dragNewPiece:function(e,n,t){u.dragNewPiece(r,e,n,t)},destroy:function(){o.stop(r),r.dom.unbind&&r.dom.unbind(),r.dom.destroyed=!0}}}},{"./anim":2,"./board":4,"./config":6,"./drag":7,"./explosion":10,"./fen":11}],4:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=e("./util"),v=e("./premove");function g(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e&&setTimeout(function(){return e.apply(void 0,n)},1)}function m(e){e.premovable.current&&(e.premovable.current=void 0,g(e.premovable.events.unset))}function b(e){var n=e.predroppable;n.current&&(n.current=void 0,g(n.events.unset))}function o(e,n,t){if(n===t||!e.pieces[n])return!1;var r=e.pieces[t]&&e.pieces[t].color!==e.pieces[n].color?e.pieces[t]:void 0;return t==e.selected&&k(e),g(e.events.move,n,t,r),function(e,n,t){if(!e.autoCastle)return!1;var r=e.pieces[n];if("king"!==r.role)return!1;var o=p.key2pos(n);if(5!==o[0])return!1;if(1!==o[1]&&8!==o[1])return!1;var i,a,s,u=p.key2pos(t);if(7===u[0]||8===u[0])i=p.pos2key([8,o[1]]),a=p.pos2key([6,o[1]]),s=p.pos2key([7,o[1]]);else{if(3!==u[0]&&1!==u[0])return!1;i=p.pos2key([1,o[1]]),a=p.pos2key([4,o[1]]),s=p.pos2key([3,o[1]])}var c=e.pieces[i];return"rook"===c.role&&(delete e.pieces[n],delete e.pieces[i],e.pieces[s]=r,e.pieces[a]=c,!0)}(e,n,t)||(e.pieces[t]=e.pieces[n],delete e.pieces[n]),e.lastMove=[n,t],e.check=void 0,g(e.events.change),r||!0}function y(e,n,t,r){if(e.pieces[t]){if(!r)return!1;delete e.pieces[t]}return g(e.events.dropNewPiece,n,t),e.pieces[t]=n,e.lastMove=[t],e.check=void 0,g(e.events.change),e.movable.dests=void 0,e.turnColor=p.opposite(e.turnColor),!0}function h(e,n,t){var r=o(e,n,t);return r&&(e.movable.dests=void 0,e.turnColor=p.opposite(e.turnColor),e.animation.current=void 0),r}function r(e,n,t){if(E(e,n,t)){var r=h(e,n,t);if(r){var o=e.hold.stop();k(e);var i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==r&&(i.captured=r),g(e.movable.events.after,n,t,i),!0}}else l=e,(f=n)!==(d=t)&&C(l,f)&&p.containsX(v.default(l.pieces,f,l.premovable.castle),d)?(s=n,u=t,c={ctrlKey:(a=e).stats.ctrlKey},b(a),a.premovable.current=[s,u],g(a.premovable.events.set,s,u,c),k(e)):P(e,t)||C(e,t)?(w(e,t),e.hold.start()):k(e);var a,s,u,c,l,f,d;return!1}function w(e,n){e.selected=n,C(e,n)?e.premovable.dests=v.default(e.pieces,n,e.premovable.castle):e.premovable.dests=void 0}function k(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function P(e,n){var t=e.pieces[n];return t&&("both"===e.movable.color||e.movable.color===t.color&&e.turnColor===t.color)}function E(e,n,t){return n!==t&&P(e,n)&&(e.movable.free||!!e.movable.dests&&p.containsX(e.movable.dests[n],t))}function C(e,n){var t=e.pieces[n];return t&&e.premovable.enabled&&e.movable.color===t.color&&e.turnColor!==t.color}function i(e){m(e),b(e),k(e)}t.callUserFunction=g,t.toggleOrientation=function(e){e.orientation=p.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},t.reset=function(e){e.lastMove=void 0,k(e),m(e),b(e)},t.setPieces=function(e,n){for(var t in n){var r=n[t];r?e.pieces[t]=r:delete e.pieces[t]}},t.setCheck=function(e,n){if(!0===n&&(n=e.turnColor),n)for(var t in e.pieces)"king"===e.pieces[t].role&&e.pieces[t].color===n&&(e.check=t);else e.check=void 0},t.unsetPremove=m,t.unsetPredrop=b,t.baseMove=o,t.baseNewPiece=y,t.userMove=r,t.dropNewPiece=function(e,n,t,r){if(p=n,v=t,(h=(d=e).pieces[p])&&v&&(p===v||!d.pieces[v])&&("both"===d.movable.color||d.movable.color===h.color&&d.turnColor===h.color)||r){var o=e.pieces[n];delete e.pieces[n],y(e,o,t,r),g(e.movable.events.afterNewPiece,o.role,t,{predrop:!1})}else c=n,l=t,(f=(u=e).pieces[c])&&l&&(!u.pieces[l]||u.pieces[l].color!==u.movable.color)&&u.predroppable.enabled&&("pawn"!==f.role||"1"!==l[1]&&"8"!==l[1])&&u.movable.color===f.color&&u.turnColor!==f.color?(a=(i=e).pieces[n].role,s=t,m(i),i.predroppable.current={role:a,key:s},g(i.predroppable.events.set,a,s)):(m(e),b(e));var i,a,s,u,c,l,f,d,p,v,h;delete e.pieces[n],k(e)},t.selectSquare=function(e,n,t){e.selected?e.selected!==n||e.draggable.enabled?(e.selectable.enabled||t)&&e.selected!==n?r(e,e.selected,n)&&(e.stats.dragged=!1):e.hold.start():(k(e),e.hold.cancel()):(P(e,n)||C(e,n))&&(w(e,n),e.hold.start()),g(e.events.select,n)},t.setSelected=w,t.unselect=k,t.canMove=E,t.isDraggable=function(e,n){var t=e.pieces[n];return t&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===t.color&&(e.turnColor===t.color||e.premovable.enabled))},t.playPremove=function(e){var n=e.premovable.current;if(!n)return!1;var t=n[0],r=n[1],o=!1;if(E(e,t,r)){var i=h(e,t,r);if(i){var a={premove:!0};!0!==i&&(a.captured=i),g(e.movable.events.after,t,r,a),o=!0}}return m(e),o},t.playPredrop=function(e,n){var t=e.predroppable.current,r=!1;return!!t&&(n(t)&&y(e,{role:t.role,color:e.movable.color},t.key)&&(g(e.movable.events.afterNewPiece,t.role,t.key,{predrop:!0}),r=!0),b(e),r)},t.cancelMove=i,t.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,i(e)},t.getKeyAtDomPos=function(e,n,t){var r=Math.ceil((e[0]-t.left)/t.width*8);n||(r=9-r);var o=Math.ceil(8-(e[1]-t.top)/t.height*8);return n||(o=9-o),0<r&&r<9&&0<o&&o<9?p.pos2key([r,o]):void 0}},{"./premove":12,"./util":17}],5:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./api"),o=e("./config"),i=e("./state"),l=e("./wrap"),f=e("./events"),d=e("./render"),p=e("./svg"),v=e("./util");t.Chessground=function(s,e){var u=i.defaults();function c(){var e=u.dom&&u.dom.unbind;s.classList.add("cg-board-wrap");var n,t,r=v.memo(function(){return s.getBoundingClientRect()}),o=u.viewOnly&&!u.drawable.visible,i=l.default(s,u,o?void 0:r()),a=function(e){d.default(u),!e&&i.svg&&p.renderSvg(u,i.svg)};u.dom={elements:i,bounds:r,redraw:(n=a,t=!1,function(){t||(t=!0,v.raf(function(){n(),t=!1}))}),redrawNow:a,unbind:e,relative:o},u.drawable.prevSvgHash="",a(!1),f.bindBoard(u),e||(u.dom.unbind=f.bindDocument(u,c))}return o.configure(u,e||{}),c(),r.start(u,c)}},{"./api":3,"./config":6,"./events":9,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],6:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("./board"),a=e("./fen");function s(e){return"object"==typeof e}t.configure=function(e,n){if(n.movable&&n.movable.dests&&(e.movable.dests=void 0),function e(n,t){for(var r in t)s(n[r])&&s(t[r])?e(n[r],t[r]):n[r]=t[r]}(e,n),n.fen&&(e.pieces=a.read(n.fen),e.drawable.shapes=[]),n.hasOwnProperty("check")&&i.setCheck(e,n.check||!1),n.hasOwnProperty("lastMove")&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&i.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var t="white"===e.movable.color?1:8,r="e"+t,o=e.movable.dests[r];if(!o||"king"!==e.pieces[r].role)return;e.movable.dests[r]=o.filter(function(e){return!(e==="a"+t&&-1!==o.indexOf("c"+t)||e==="h"+t&&-1!==o.indexOf("g"+t))})}}},{"./board":4,"./fen":11}],7:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=e("./board"),h=e("./util"),g=e("./draw"),m=e("./anim");function b(a){h.raf(function(){var e=a.draggable.current;if(e){a.animation.current&&a.animation.current.plan.anims[e.orig]&&(a.animation.current=void 0);var n=a.pieces[e.orig];if(n&&h.samePiece(n,e.piece)){if(!e.started&&h.distanceSq(e.epos,e.rel)>=Math.pow(a.draggable.distance,2)&&(e.started=!0),e.started){if("function"==typeof e.element){var t=e.element();if(!t)return;e.element=t,e.element.cgDragging=!0,e.element.classList.add("dragging")}var r="white"===a.orientation,o=a.dom.bounds();e.pos=[e.epos[0]-e.rel[0],e.epos[1]-e.rel[1]];var i=h.posToTranslateAbs(o)(e.origPos,r);i[0]+=e.pos[0]+e.dec[0],i[1]+=e.pos[1]+e.dec[1],h.translateAbs(e.element,i)}}else s(a);b(a)}})}function s(e){var n=e.draggable.current;n&&(n.newPiece&&delete e.pieces[n.orig],e.draggable.current=void 0,v.unselect(e),i(e),e.dom.redraw())}function i(e){var n=e.dom.elements;n.ghost&&h.setVisible(n.ghost,!1)}function y(e,n,t){var r=h.key2pos(e);return n||(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function w(e,n){for(var t=e.dom.elements.board.firstChild;t;){if(t.cgKey===n&&"PIECE"===t.tagName)return t;t=t.nextSibling}}t.start=function(e,n){if(!(void 0!==n.button&&0!==n.button||n.touches&&1<n.touches.length)){n.preventDefault();var t="white"===e.orientation,r=e.dom.bounds(),o=h.eventPosition(n),i=v.getKeyAtDomPos(o,t,r);if(i){var a=e.pieces[i],s=e.selected;s||!e.drawable.enabled||!e.drawable.eraseOnClick&&a&&a.color===e.turnColor||g.clear(e);var u=!!e.premovable.current,c=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&v.canMove(e,e.selected,i)?m.anim(function(e){return v.selectSquare(e,i)},e):v.selectSquare(e,i);var l=e.selected===i,f=w(e,i);if(a&&f&&l&&v.isDraggable(e,i)){var d=y(i,t,r);e.draggable.current={orig:i,origPos:h.key2pos(i),piece:a,rel:o,epos:o,pos:[0,0],dec:e.draggable.centerPiece?[o[0]-(d.left+d.width/2),o[1]-(d.top+d.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:f,previouslySelected:s,originTarget:n.target},f.cgDragging=!0,f.classList.add("dragging");var p=e.dom.elements.ghost;p&&(p.className="ghost "+a.color+" "+a.role,h.translateAbs(p,h.posToTranslateAbs(r)(h.key2pos(i),t)),h.setVisible(p,!0)),b(e)}else u&&v.unsetPremove(e),c&&v.unsetPredrop(e);e.dom.redraw()}}},t.dragNewPiece=function(e,n,t,r){var o="a0";e.pieces.a0=n,e.dom.redraw();var i=h.eventPosition(t),a="white"===e.orientation,s=e.dom.bounds(),u=y(o,a,s),c=[(a?0:7)*u.width+s.left,(a?8:-1)*u.height+s.top];e.draggable.current={orig:o,origPos:h.key2pos(o),piece:n,rel:c,epos:i,pos:[i[0]-c[0],i[1]-c[1]],dec:[-u.width/2,-u.height/2],started:!0,element:function(){return w(e,o)},originTarget:t.target,newPiece:!0,force:r||!1},b(e)},t.move=function(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.epos=h.eventPosition(n))},t.end=function(e,n){var t=e.draggable.current;if(t)if("touchend"!==n.type||!t||t.originTarget===n.target||t.newPiece){v.unsetPremove(e),v.unsetPredrop(e);var r=h.eventPosition(n)||t.epos,o=v.getKeyAtDomPos(r,"white"===e.orientation,e.dom.bounds());o&&t.started?t.newPiece?v.dropNewPiece(e,t.orig,o,t.force):(e.stats.ctrlKey=n.ctrlKey,v.userMove(e,t.orig,o)&&(e.stats.dragged=!0)):t.newPiece?delete e.pieces[t.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[t.orig],v.callUserFunction(e.events.change)),(!t||t.orig!==t.previouslySelected||t.orig!==o&&o)&&e.selectable.enabled||v.unselect(e),i(e),e.draggable.current=void 0,e.dom.redraw()}else e.draggable.current=void 0},t.cancel=s},{"./anim":2,"./board":4,"./draw":8,"./util":17}],8:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=e("./board"),u=e("./util"),c=["green","red","blue","yellow"];function l(t){u.raf(function(){var e=t.drawable.current;if(e){var n=s.getKeyAtDomPos(e.pos,"white"===t.orientation,t.dom.bounds());n!==e.mouseSq&&(e.mouseSq=n,e.dest=n!==e.orig?n:void 0,t.dom.redrawNow()),l(t)}})}function f(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function d(e){e.onChange&&e.onChange(e.shapes)}t.start=function(e,n){if(!(n.touches&&1<n.touches.length)){n.stopPropagation(),n.preventDefault(),n.ctrlKey?s.unselect(e):s.cancelMove(e);var t,r,o,i=u.eventPosition(n),a=s.getKeyAtDomPos(i,"white"===e.orientation,e.dom.bounds());a&&(e.drawable.current={orig:a,pos:i,brush:(t=n,r=t.shiftKey&&u.isRightButton(t)?1:0,o=t.altKey?2:0,c[r+o])},l(e))}},t.processDraw=l,t.move=function(e,n){e.drawable.current&&(e.drawable.current.pos=u.eventPosition(n))},t.end=function(e){var n=e.drawable.current;n&&(n.mouseSq&&(t=e.drawable,r=n,i=function(e){return e.orig===r.orig&&e.dest===r.dest},a=t.shapes.filter(i)[0],a&&(t.shapes=t.shapes.filter((o=i,function(e){return!o(e)}))),a&&a.brush===r.brush||t.shapes.push(r),d(t)),f(e));var t,r,o,i,a},t.cancel=f,t.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),d(e.drawable))}},{"./board":4,"./util":17}],9:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=e("./drag"),s=e("./draw"),u=e("./util");function c(e,n,t,r){return e.addEventListener(n,t,r),function(){return e.removeEventListener(n,t)}}function l(n,t,r){return function(e){e.shiftKey||u.isRightButton(e)?n.drawable.enabled&&r(n,e):n.viewOnly||t(n,e)}}t.bindBoard=function(e){if(!e.viewOnly){var n,t=e.dom.elements.board,r=(n=e,function(e){n.draggable.current?a.cancel(n):n.drawable.current?s.cancel(n):e.shiftKey||u.isRightButton(e)?n.drawable.enabled&&s.start(n,e):n.viewOnly||a.start(n,e)});t.addEventListener("touchstart",r),t.addEventListener("mousedown",r),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",function(e){return e.preventDefault()})}},t.bindDocument=function(e,n){var t=[];!e.dom.relative&&e.resizable&&t.push(c(document.body,"chessground.resize",function(){e.dom.bounds.clear(),u.raf(n)}));if(!e.viewOnly){var r=l(e,a.move,s.move),o=l(e,a.end,s.end);["touchmove","mousemove"].forEach(function(e){return t.push(c(document,e,r))}),["touchend","mouseup"].forEach(function(e){return t.push(c(document,e,o))});var i=function(){return e.dom.bounds.clear()};t.push(c(window,"scroll",i,{passive:!0})),t.push(c(window,"resize",i,{passive:!0}))}return function(){return t.forEach(function(e){return e()})}}},{"./drag":7,"./draw":8,"./util":17}],10:[function(e,n,t){"use strict";function r(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(function(){r(e,2),setTimeout(function(){return r(e,void 0)},120)},120)}},{}],11:[function(e,n,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var l=e("./util"),i=e("./types");c.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var f={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},a={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};c.read=function(e){"start"===e&&(e=c.initial);for(var n={},t=8,r=0,o=0,i=e;o<i.length;o++){var a=i[o];switch(a){case" ":return n;case"/":if(0==--t)return n;r=0;break;case"~":n[l.pos2key([r,t])].promoted=!0;break;default:var s=a.charCodeAt(0);if(s<57)r+=s-48;else{++r;var u=a.toLowerCase();n[l.pos2key([r,t])]={role:f[u],color:a===u?"black":"white"}}}}return n},c.write=function(t){var r,o;return l.invRanks.map(function(n){return i.ranks.map(function(e){return(r=t[l.pos2key([e,n])])?(o=a[r.role],"white"===r.color?o.toUpperCase():o):"1"}).join("")}).join("/").replace(/1{2,}/g,function(e){return e.length.toString()})}},{"./types":16,"./util":17}],12:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=e("./util");function v(e,n){return Math.abs(e-n)}var h=function(e,n,t,r){var o=v(e,t),i=v(n,r);return 1===o&&2===i||2===o&&1===i},g=function(e,n,t,r){return v(e,t)===v(n,r)},m=function(e,n,t,r){return e===t||n===r},b=function(e,n,t,r){return g(e,n,t,r)||m(e,n,t,r)};t.default=function(e,n,t){var r,o,i,a,s,u,c,l,f=e[n],d=p.key2pos(n);switch(f.role){case"pawn":l=f.color,r=function(e,n,t,r){return v(e,t)<2&&("white"===l?r===n+1||n<=2&&r===n+2&&e===t:r===n-1||7<=n&&r===n-2&&e===t)};break;case"knight":r=h;break;case"bishop":r=g;break;case"rook":r=m;break;case"queen":r=b;break;case"king":o=f.color,s=e,u=f.color,i=Object.keys(s).filter(function(e){return(c=s[e])&&c.color===u&&"rook"===c.role}).map(function(e){return p.key2pos(e)[0]}),a=t,r=function(e,n,t,r){return v(e,t)<2&&v(n,r)<2||a&&n===r&&n===("white"===o?1:8)&&(5===e&&(3===t||7===t)||p.containsX(i,t))}}return p.allKeys.map(p.key2pos).filter(function(e){return(d[0]!==e[0]||d[1]!==e[1])&&r(d[0],d[1],e[0],e[1])}).map(p.pos2key)}},{"./util":17}],13:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var j=e("./util"),R=e("./util");function q(e,n){for(var t in n)e.dom.elements.board.removeChild(n[t])}function K(e,n){var t=2+8*(e[1]-1)+(8-e[0]);return n&&(t=67-t),t+""}function U(e){return e.color+" "+e.role}function B(e,n,t){e[n]?e[n]+=" "+t:e[n]=t}t.default=function(e){var n,t,r,o,i,a,s,u,c,l,f,d="white"===e.orientation,p=e.dom.relative?R.posToTranslateRel:R.posToTranslateAbs(e.dom.bounds()),v=e.dom.relative?R.translateRel:R.translateAbs,h=e.dom.elements.board,g=e.pieces,m=e.animation.current,b=m?m.plan.anims:{},y=m?m.plan.fadings:{},w=e.draggable.current,k=function(e){var n,t,r={};if(e.lastMove&&e.highlight.lastMove)for(n in e.lastMove)B(r,e.lastMove[n],"last-move");if(e.check&&e.highlight.check&&B(r,e.check,"check"),e.selected&&(B(r,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(n in o)t=o[n],B(r,t,"move-dest"+(e.pieces[t]?" oc":""));var i=e.premovable.dests;if(i)for(n in i)t=i[n],B(r,t,"premove-dest"+(e.pieces[t]?" oc":""))}var a=e.premovable.current;if(a)for(n in a)B(r,a[n],"current-premove");else e.predroppable.current&&B(r,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(n in s.keys)B(r,s.keys[n],"exploding"+s.stage);return r}(e),P={},E={},C={},A={},_=Object.keys(g);for(r=h.firstChild;r;){if(n=r.cgKey,"PIECE"===r.tagName)o=g[n],a=b[n],s=y[n],i=r.cgPiece,!r.cgDragging||w&&w.orig===n||(r.classList.remove("dragging"),v(r,p(j.key2pos(n),d)),r.cgDragging=!1),!s&&r.cgFading&&(r.cgFading=!1,r.classList.remove("fading")),o?(a&&r.cgAnimating&&i===U(o)?((L=j.key2pos(n))[0]+=a[2],L[1]+=a[3],r.classList.add("anim"),v(r,p(L,d))):r.cgAnimating&&(r.cgAnimating=!1,r.classList.remove("anim"),v(r,p(j.key2pos(n),d)),e.addPieceZIndex&&(r.style.zIndex=K(j.key2pos(n),d))),i!==U(o)||s&&r.cgFading?s&&i===U(s)?(r.classList.add("fading"),r.cgFading=!0):C[i]?C[i].push(r):C[i]=[r]:P[n]=!0):C[i]?C[i].push(r):C[i]=[r];else if("SQUARE"===r.tagName){var S=r.className;k[n]===S?E[n]=!0:A[S]?A[S].push(r):A[S]=[r]}r=r.nextSibling}for(var O in k)if(!E[O]){f=(l=A[k[O]])&&l.pop();var T=p(j.key2pos(O),d);if(f)f.cgKey=O,v(f,T);else{var x=j.createEl("square",k[O]);x.cgKey=O,v(x,T),h.insertBefore(x,h.firstChild)}}for(var M in _)if(t=g[n=_[M]],a=b[n],!P[n])if(c=(u=C[U(t)])&&u.pop()){c.cgKey=n,c.cgFading&&(c.classList.remove("fading"),c.cgFading=!1);var L=j.key2pos(n);e.addPieceZIndex&&(c.style.zIndex=K(L,d)),a&&(c.cgAnimating=!0,c.classList.add("anim"),L[0]+=a[2],L[1]+=a[3]),v(c,p(L,d))}else{var I=U(t),N=j.createEl("piece",I);L=j.key2pos(n),N.cgPiece=I,N.cgKey=n,a&&(N.cgAnimating=!0,L[0]+=a[2],L[1]+=a[3]),v(N,p(L,d)),e.addPieceZIndex&&(N.style.zIndex=K(L,d)),h.appendChild(N)}for(var D in C)q(e,C[D]);for(var D in A)q(e,A[D])}},{"./util":17}],14:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./fen"),o=e("./util");t.defaults=function(){return{pieces:r.read(r.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:o.timer()}}},{"./fen":11,"./util":17}],15:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var W,F=e("./util");function $(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function c(e,n,t){var r,o,i=e.orig,a=e.dest,s=e.brush,u=e.piece,c=e.modifiers;return[t,i,a,s,a&&1<n[a],u&&(o=u,[o.color,o.role,o.scale].filter(function(e){return e}).join("")),c&&(r=c,""+(r.lineWidth||""))].filter(function(e){return e}).join("")}function l(e){var n=H($("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return n.appendChild(H($("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function H(e,n){for(var t in n)e.setAttribute(t,n[t]);return e}function G(e,n){return"white"===n?e:[9-e[0],9-e[1]]}function X(e,n){var t={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth)};return t.key=[e.key,n.lineWidth].filter(function(e){return e}).join(""),t}function Z(e,n){return(e.opacity||1)*(n?.9:1)}function V(e,n){return[(e[0]-.5)*n.width/8,(8.5-e[1])*n.height/8]}t.createElement=$,t.renderSvg=function(e,n){var t=e.drawable,r=t.current,o=r&&r.mouseSq?r:void 0,i={};t.shapes.concat(t.autoShapes).concat(o?[o]:[]).forEach(function(e){e.dest&&(i[e.dest]=(i[e.dest]||0)+1)});var a=t.shapes.concat(t.autoShapes).map(function(e){return{shape:e,current:!1,hash:c(e,i,!1)}});o&&a.push({shape:o,current:!0,hash:c(o,i,!0)});var s=a.map(function(e){return e.hash}).join("");if(s!==e.drawable.prevSvgHash){e.drawable.prevSvgHash=s;var u=n.firstChild;!function(n,e,t){var r,o={};e.forEach(function(e){e.shape.dest&&(r=n.brushes[e.shape.brush],e.shape.modifiers&&(r=X(r,e.shape.modifiers)),o[r.key]=r)});for(var i={},a=t.firstChild;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in o)i[s]||t.appendChild(l(o[s]))}(t,a,u),function(n,e,t,r,o,i){void 0===W&&(W=F.computeIsTrident());var a=n.dom.bounds(),s={},u=[];e.forEach(function(e){s[e.hash]=!1});for(var c,l=i.nextSibling;l;)c=l.getAttribute("cgHash"),s.hasOwnProperty(c)?s[c]=!0:u.push(l),l=l.nextSibling;u.forEach(function(e){return o.removeChild(e)}),e.forEach(function(e){s[e.hash]||o.appendChild(function(e,n,t,r,o){var i,a,s,u,c,l,f,d,p,v,h,g,m,b,y,w,k,P,E,C,A,_,S,O,T,x,M,L,I,N,D,j,R,q,K=n.shape,U=n.current,B=n.hash;if(K.piece)L=e.drawable.pieces.baseUrl,I=G(F.key2pos(K.orig),e.orientation),N=K.piece,j=V(I,D=o),R=D.width/8*(N.scale||1),q=N.color[0]+("knight"===N.role?"n":N.role[0]).toUpperCase(),i=H($("image"),{className:N.role+" "+N.color,x:j[0]-R/2,y:j[1]-R/2,width:R,height:R,href:L+q+".svg"});else{var z=G(F.key2pos(K.orig),e.orientation);if(K.orig&&K.dest){var Q=t[K.brush];K.modifiers&&(Q=X(Q,K.modifiers)),p=Q,v=z,h=G(F.key2pos(K.dest),e.orientation),g=U,m=1<r[K.dest],S=b=o,O=m&&!g,y=W?0:(O?20:10)/512*S.width,w=V(v,b),k=V(h,b),P=k[0]-w[0],E=k[1]-w[1],C=Math.atan2(E,P),A=Math.cos(C)*y,_=Math.sin(C)*y,i=H($("line"),{stroke:p.color,"stroke-width":(T=p,x=g,M=b,(T.lineWidth||10)*(x?.85:1)/512*M.width),"stroke-linecap":"round","marker-end":W?void 0:"url(#arrowhead-"+p.key+")",opacity:Z(p,g),x1:w[0],y1:w[1],x2:k[0]-A,y2:k[1]-_})}else a=t[K.brush],s=U,c=V(z,u=o),d=u.width/512,l=[3*d,4*d],f=(u.width+u.height)/32,i=H($("circle"),{stroke:a.color,"stroke-width":l[s?0:1],fill:"none",opacity:Z(a,s),cx:c[0],cy:c[1],r:f-l[1]/2})}return i.setAttribute("cgHash",B),i}(n,e,t,r,a))})}(e,a,t.brushes,i,n,u)}}},{"./util":17}],16:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.files=["a","b","c","d","e","f","g","h"],t.ranks=[1,2,3,4,5,6,7,8]},{}],17:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./types");t.colors=["white","black"],t.invRanks=[8,7,6,5,4,3,2,1],t.allKeys=(o=Array.prototype).concat.apply(o,r.files.map(function(n){return r.ranks.map(function(e){return n+e})})),t.pos2key=function(e){return t.allKeys[8*e[0]+e[1]-9]},t.key2pos=function(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]},t.memo=function(e){var n,t=function(){return void 0===n&&(n=e()),n};return t.clear=function(){n=void 0},t},t.timer=function(){var n;return{start:function(){n=Date.now()},cancel:function(){n=void 0},stop:function(){if(!n)return 0;var e=Date.now()-n;return n=void 0,e}}},t.opposite=function(e){return"white"===e?"black":"white"},t.containsX=function(e,n){return void 0!==e&&-1!==e.indexOf(n)},t.distanceSq=function(e,n){return Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)},t.samePiece=function(e,n){return e.role===n.role&&e.color===n.color},t.computeIsTrident=function(){return-1<window.navigator.userAgent.indexOf("Trident/")};var o,i=function(e,n,t,r){return[(n?e[0]-1:8-e[0])*t,(n?8-e[1]:e[1]-1)*r]};t.posToTranslateAbs=function(e){var t=e.width/8,r=e.height/8;return function(e,n){return i(e,n,t,r)}},t.posToTranslateRel=function(e,n){return i(e,n,12.5,12.5)},t.translateAbs=function(e,n){e.style.transform="translate("+n[0]+"px,"+n[1]+"px)"},t.translateRel=function(e,n){e.style.left=n[0]+"%",e.style.top=n[1]+"%"},t.setVisible=function(e,n){e.style.visibility=n?"visible":"hidden"},t.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},t.isRightButton=function(e){return 2===e.buttons||2===e.button},t.createEl=function(e,n){var t=document.createElement(e);return n&&(t.className=n),t},t.raf=(window.requestAnimationFrame||window.setTimeout).bind(window)},{"./types":16}],18:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=e("./util"),u=e("./types"),c=e("./svg");function l(e,n){var t,r=s.createEl("coords",n);for(var o in e)(t=s.createEl("coord")).textContent=e[o],r.appendChild(t);return r}t.default=function(n,t,e){n.innerHTML="",n.classList.add("cg-board-wrap"),s.colors.forEach(function(e){n.classList.toggle("orientation-"+e,t.orientation===e)}),n.classList.toggle("manipulable",!t.viewOnly);var r,o,i=s.createEl("div","cg-board");if(n.appendChild(i),t.drawable.visible&&e&&((r=c.createElement("svg")).appendChild(c.createElement("defs")),n.appendChild(r)),t.coordinates){var a="black"===t.orientation?" black":"";n.appendChild(l(u.ranks,"ranks"+a)),n.appendChild(l(u.files,"files"+a))}return e&&t.draggable.showGhost&&(o=s.createEl("piece","ghost"),s.setVisible(o,!1),n.appendChild(o)),{board:i,ghost:o,svg:r}}},{"./svg":15,"./types":16,"./util":17}],19:[function(e,be,ye){!function(v,t,f,G,u,X){var h=p(function(t,r){var o=r.length;return p(function(e){for(var n=0;n<e.length;n++)r[o+n]=e[n];return r.length=o+e.length,t.apply(this,r)})});p(function(e){var n=T(e);function t(e,n){return[d(e,n)]}return p(function(e){return M(t,e,n)[0]})});function g(e,n){return function(){return e.call(this,n.apply(this,arguments))}}function r(n){return function(e){return e[n]}}var m=p(function(r){return p(function(e){for(var n,t=0;t<P(r);t++)if(n=d(e,r[t]))return n})});function d(e,n){return n.apply(X,e)}function p(n){var t=n.length-1,r=f.prototype.slice;if(0==t)return function(){return n.call(this,r.call(arguments))};if(1==t)return function(){return n.call(this,arguments[0],r.call(arguments,1))};var o=f(n.length);return function(){for(var e=0;e<t;e++)o[e]=arguments[e];return o[t]=r.call(arguments,t),n.apply(this,o)}}function b(n,t){return function(e){return n(e)&&t(e)}}function y(){}function w(){return!0}function k(e,n){return n&&n.constructor===e}var P=r("length"),E=h(k,String);function C(e){return e!==X}function A(e,n){return n instanceof t&&function e(n,t){return!t||n(S(t))&&e(n,O(t))}(function(e){return e in n},e)}function _(e,n){return[e,n]}var o=null,S=r(0),O=r(1);function T(e){return L(e.reduce((t=_,function(e,n){return t(n,e)}),o));var t}var x=p(T);function s(e){return M(function(e,n){return e.unshift(n),e},[],e)}function c(e,n){return n?_(e(S(n)),c(e,O(n))):o}function M(e,n,t){return t?e(M(e,n,O(t)),S(t)):n}function l(e,r,n){return function e(n,t){return n?r(S(n))?(t(S(n)),O(n)):_(S(n),e(O(n),t)):o}(e,n||y)}function L(e){return function e(n,t){return n?e(O(n),_(S(n),t)):t}(e,o)}function a(e){"use strict";var i,a,s,u=e(ce).emit,c=e(le).emit,l=e(fe).emit,n=e(te).emit,f=65536,d=/[\\"\n]/g,t=0,p=t++,v=t++,h=t++,g=t++,m=t++,b=t++,y=t++,w=t++,k=t++,P=t++,E=t++,C=t++,A=t++,_=t++,S=t++,O=t++,T=t++,x=t++,M=t++,L=t++,I=f,N=X,D="",j=!1,R=!1,q=p,K=[],U=null,B=0,z=0,Q=0,W=0,F=1;function $(e){N!==X&&(c(N),l(),N=X),i=G(e+"\nLn: "+F+"\nCol: "+W+"\nChr: "+a),n(de(X,X,i))}function H(e){return"\r"==e||"\n"==e||" "==e||"\t"==e}e(ae).on(function(e){if(i)return;if(R)return $("Cannot write after close");var n=0;a=e[0];for(;a&&(0<n&&(s=a),a=e[n++]);)switch(Q++,"\n"==a?(F++,W=0):W++,q){case p:if("{"===a)q=h;else if("["===a)q=m;else if(!H(a))return $("Non-whitespace before {[.");continue;case w:case h:if(H(a))continue;if(q===w)K.push(k);else{if("}"===a){c({}),l(),q=K.pop()||v;continue}K.push(g)}if('"'!==a)return $('Malformed object key should start with " ');q=y;continue;case k:case g:if(H(a))continue;if(":"===a)q===g?(K.push(g),N!==X&&(c({}),u(N),N=X),z++):N!==X&&(u(N),N=X),q=v;else if("}"===a)N!==X&&(c(N),l(),N=X),l(),z--,q=K.pop()||v;else{if(","!==a)return $("Bad object");q===g&&K.push(g),N!==X&&(c(N),l(),N=X),q=w}continue;case m:case v:if(H(a))continue;if(q===m){if(c([]),z++,q=v,"]"===a){l(),z--,q=K.pop()||v;continue}K.push(b)}if('"'===a)q=y;else if("{"===a)q=h;else if("["===a)q=m;else if("t"===a)q=P;else if("f"===a)q=A;else if("n"===a)q=T;else if("-"===a)D+=a;else if("0"===a)D+=a,q=20;else{if(-1==="123456789".indexOf(a))return $("Bad value");D+=a,q=20}continue;case b:if(","===a)K.push(b),N!==X&&(c(N),l(),N=X),q=v;else{if("]"!==a){if(H(a))continue;return $("Bad array")}N!==X&&(c(N),l(),N=X),l(),z--,q=K.pop()||v}continue;case y:N===X&&(N="");var t=n-1;e:for(;;){for(;0<B;)if(U+=a,a=e.charAt(n++),4===B?(N+=String.fromCharCode(parseInt(U,16)),B=0,t=n-1):B++,!a)break e;if('"'===a&&!j){q=K.pop()||v,N+=e.substring(t,n-1);break}if(!("\\"!==a||j||(j=!0,N+=e.substring(t,n-1),a=e.charAt(n++))))break;if(j){if(j=!1,"n"===a?N+="\n":"r"===a?N+="\r":"t"===a?N+="\t":"f"===a?N+="\f":"b"===a?N+="\b":"u"===a?(B=1,U=""):N+=a,a=e.charAt(n++),t=n-1,a)continue;break}d.lastIndex=n;var r=d.exec(e);if(!r){n=e.length+1,N+=e.substring(t,n-1);break}if(n=r.index+1,!(a=e.charAt(r.index))){N+=e.substring(t,n-1);break}}continue;case P:if(!a)continue;if("r"!==a)return $("Invalid true started with t"+a);q=E;continue;case E:if(!a)continue;if("u"!==a)return $("Invalid true started with tr"+a);q=C;continue;case C:if(!a)continue;if("e"!==a)return $("Invalid true started with tru"+a);c(!0),l(),q=K.pop()||v;continue;case A:if(!a)continue;if("a"!==a)return $("Invalid false started with f"+a);q=_;continue;case _:if(!a)continue;if("l"!==a)return $("Invalid false started with fa"+a);q=S;continue;case S:if(!a)continue;if("s"!==a)return $("Invalid false started with fal"+a);q=O;continue;case O:if(!a)continue;if("e"!==a)return $("Invalid false started with fals"+a);c(!1),l(),q=K.pop()||v;continue;case T:if(!a)continue;if("u"!==a)return $("Invalid null started with n"+a);q=x;continue;case x:if(!a)continue;if("l"!==a)return $("Invalid null started with nu"+a);q=M;continue;case M:if(!a)continue;if("l"!==a)return $("Invalid null started with nul"+a);c(null),l(),q=K.pop()||v;continue;case L:if("."!==a)return $("Leading zero not followed by .");D+=a,q=20;continue;case 20:if(-1!=="0123456789".indexOf(a))D+=a;else if("."===a){if(-1!==D.indexOf("."))return $("Invalid number has two dots");D+=a}else if("e"===a||"E"===a){if(-1!==D.indexOf("e")||-1!==D.indexOf("E"))return $("Invalid number has two exponential");D+=a}else if("+"===a||"-"===a){if("e"!==s&&"E"!==s)return $("Invalid symbol in number");D+=a}else D&&(c(parseFloat(D)),l(),D=""),n--,q=K.pop()||v;continue;default:return $("Unknown state: "+q)}I<=Q&&(o=0,N!==X&&N.length>f&&($("Max buffer length exceeded: textNode"),o=Math.max(o,N.length)),D.length>f&&($("Max buffer length exceeded: numberNode"),o=Math.max(o,D.length)),I=f-o+Q);var o}),e(se).on(function(){if(q==p)return c({}),l(),void(R=!0);q===v&&0===z||$("Unexpected end");N!==X&&(c(N),l(),N=X);R=!0})}var e,n,i,I,N,D,j,R,q,K,U,B=(e=p(function(e){return e.unshift(/^/),(n=RegExp(e.map(r("source")).join(""))).exec.bind(n);var n}),I=e(n=/(\$?)/,/([\w-_]+|\*)/,i=/(?:{([\w ]*?)})?/),N=e(n,/\["([^"]+)"\]/,i),D=e(n,/\[(\d+|\*)\]/,i),j=e(n,/()/,/{([\w ]*?)}/),R=e(/\.\./),q=e(/\./),K=e(n,/!/),U=e(/$/),function(e){return e(m(I,N,D,j),R,q,K,U)});function z(e,n){return{key:e,node:n}}var Q=r("key"),W=r("node"),F={};function $(e){var o=e(Y).emit,n=e(J).emit,u=e(oe).emit,t=e(re).emit;function c(e,n,t){W(S(e))[n]=t}function l(e,n,t){e&&c(e,n,t);var r=_(z(n,t),e);return o(r),r}var r={};return r[le]=function(e,n){if(!e)return u(n),l(e,F,n);var t,r,o,i=(r=n,o=W(S(t=e)),k(f,o)?l(t,P(o),r):t),a=O(i),s=Q(S(i));return c(a,s,n),_(z(s,n),a)},r[fe]=function(e){return n(e),O(e)||t(W(S(e)))},r[ce]=l,r}var H=B(function(e,n,t,r,o){var i=g(Q,S),a=g(W,S);function s(e,n){return!!n[1]?b(e,S):e}function u(e){if(e==w)return w;return b(function(e){return i(e)!=F},g(e,O))}function c(){return function(e){return i(e)==F}}function l(e,n,t,r,o){var i,a=e(t);if(a){var s=(i=a,M(function(e,n){return n(e,i)},r,n));return o(t.substr(P(a[0])),s)}}function f(e,n){return h(l,e,n)}var d=m(f(e,x(s,function(e,n){var t=n[3];return t?b(g(h(A,T(t.split(/\W+/))),a),e):e},function(e,n){var t=n[2];return b(t&&"*"!=t?function(e){return i(e)==t}:w,e)},u)),f(n,x(function(e){if(e==w)return w;var n=c(),t=e,r=u(function(e){return o(e)}),o=m(n,t,r);return o})),f(t,x()),f(r,x(s,c)),f(o,x(function(t){return function(e){var n=t(e);return!0===n?S(e):n}})),function(e){throw G('"'+e+'" could not be tokenised')});function p(e,n){return n}function v(e,n){return d(e,n,e?v:p)}return function(n){try{return v(n,w)}catch(e){throw G('Could not compile "'+n+'" because '+e.message)}}});function Z(r,o,t){var i,a;function s(n){return function(e){return e.id==n}}return{on:function(e,n){var t={listener:e,id:n||e};return o&&o.emit(r,e,t.id),i=_(t,i),a=_(e,a),this},emit:function(){!function e(n,t){n&&(S(n).apply(null,t),e(O(n),t))}(a,arguments)},un:function(e){var n;i=l(i,s(e),function(e){n=e}),n&&(a=l(a,function(e){return e==n.listener}),t&&t.emit(r,n.listener,n.id))},listeners:function(){return a},hasListener:function(e){return C(function e(n,t){return t&&(n(S(t))?S(t):e(n,O(t)))}(e?s(e):w,i))}}}var V=1,Y=V++,J=V++,ee=V++,ne=V++,te="fail",re=V++,oe=V++,ie="start",ae="data",se="end",ue=V++,ce=V++,le=V++,fe=V++;function de(e,n,t){try{var r=u.parse(n)}catch(e){}return{statusCode:e,body:n,jsonBody:r,thrown:t}}function pe(r,o){var i={node:r(J),path:r(Y)};function a(n,t,i){var a=r(n).emit;t.on(function(e){var n,t,r,o=i(e);!1!==o&&(n=a,t=W(o),r=L(e),n(t,s(O(c(Q,r))),s(c(W,r))))},n),r("removeListener").on(function(e){e==n&&(r(e).listeners()||t.un(n))})}r("newListener").on(function(e){var n=/(node|path):(.*)/.exec(e);if(n){var t=i[n[1]];t.hasListener(e)||a(e,t,o(n[2]))}})}function ve(i,e){var o,a=/^(node|path):./,s=i(re),u=i(ne).emit,c=i(ee).emit,n=p(function(e,n){if(o[e])d(n,o[e]);else{var t=i(e),r=n[0];a.test(e)?l(t,r):t.on(r)}return o});function l(n,e,t){t=t||e;var r=f(e);return n.on(function(){var e=!1;o.forget=function(){e=!0},d(arguments,r),delete o.forget,e&&n.un(t)},t),o}function f(e){return function(){try{return e.apply(o,arguments)}catch(e){setTimeout(function(){throw new G(e.message)})}}}function r(e,n,t){var r,o;"node"==e?(o=t,r=function(){var e=o.apply(this,arguments);C(e)&&(e==me.drop?u():c(e))}):r=t,l(i(e+":"+n),r,t)}function t(e,n,t){return E(n)?r(e,n,t):function(e,n){for(var t in n)r(e,t,n[t])}(e,n),o}return i(oe).on(function(e){var n;o.root=(n=e,function(){return n})}),i(ie).on(function(e,n){o.header=function(e){return e?n[e]:n}}),o={on:n,addListener:n,removeListener:function(e,n,t){if("done"==e)s.un(n);else if("node"==e||"path"==e)i.un(e+":"+n,t);else{var r=n;i(e).un(r)}return o},emit:i.emit,node:h(t,"node"),path:h(t,"path"),done:h(l,s),start:h(function(e,n){return i(e).on(f(n),n),o},ie),fail:i(te).on,abort:i(ue).emit,header:y,root:y,source:e}}function he(e,n,t,r,o){var i=function(){var n={},t=o("newListener"),r=o("removeListener");function o(e){return n[e]=Z(e,t,r)}function i(e){return n[e]||o(e)}return["emit","on","un"].forEach(function(t){i[t]=p(function(e,n){d(n,i(e)[t])})}),i}();return n&&function(n,r,e,t,o,i,a){"use strict";var s,u=n(ae).emit,c=n(te).emit,l=0,f=!0;function d(){var e=r.responseText,n=e.substr(l);n&&u(n),l=P(e)}n(ue).on(function(){r.onreadystatechange=null,r.abort()}),"onprogress"in r&&(r.onprogress=d),r.onreadystatechange=function(){function e(){try{f&&n(ie).emit(r.status,(e=r.getAllResponseHeaders(),t={},e&&e.split("\r\n").forEach(function(e){var n=e.indexOf(": ");t[e.substring(0,n)]=e.substring(n+2)}),t)),f=!1}catch(e){}var e,t}switch(r.readyState){case 2:case 3:return e();case 4:e(),2==String(r.status)[0]?(d(),n(se).emit()):c(de(r.status,r.responseText))}};try{for(var p in r.open(e,t,!0),i)r.setRequestHeader(p,i[p]);(function(n,e){function t(e){return e.port||{"http:":80,"https:":443}[e.protocol||n.protocol]}return!!(e.protocol&&e.protocol!=n.protocol||e.host&&e.host!=n.host||e.host&&t(e)!=t(n))})(v.location,{protocol:(s=/(\w+:)?(?:\/\/)([\w.-]+)?(?::(\d+))?\/?/.exec(t)||[])[1]||"",host:s[2]||"",port:s[3]||""})||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.withCredentials=a,r.send(o)}catch(e){v.setTimeout(h(c,de(X,X,e)),0)}}(i,new XMLHttpRequest,e,n,t,r,o),a(i),function(n,t){"use strict";var o,r={};function e(n){return function(e){o=n(o,e)}}for(var i in t)n(i).on(e(t[i]),r);n(ee).on(function(e){var n=S(o),t=Q(n),r=O(o);r&&(W(S(r))[t]=e)}),n(ne).on(function(){var e=S(o),n=Q(e),t=O(o);t&&delete W(S(t))[n]}),n(ue).on(function(){for(var e in t)n(e).un(r)})}(i,$(i)),pe(i,H),ve(i,n)}function ge(e,n,t,r,o,i,a){return o=o?u.parse(u.stringify(o)):{},r?(E(r)||(r=u.stringify(r),o["Content-Type"]=o["Content-Type"]||"application/json"),o["Content-Length"]=o["Content-Length"]||r.length):r=null,e(t||"GET",(s=n,!1===a&&(-1==s.indexOf("?")?s+="?":s+="&",s+="_="+(new Date).getTime()),s),r,o,i||!1);var s}function me(e){var n=x("resume","pause","pipe"),t=h(A,n);return e?t(e)||E(e)?ge(he,e):ge(he,e.url,e.method,e.body,e.headers,e.withCredentials,e.cached):he()}me.drop=function(){return me.drop},"object"==typeof ye?be.exports=me:v.oboe=me}(function(){try{return window}catch(e){return self}}(),Object,Array,Error,JSON)},{}],20:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=e("chess.js"),s=e("./puzzle"),r=function(){function e(e){this.gameAnalysis=e}return e.prototype.puzzles=function(e){var r=this,n=new a.Chess,o=[];this.gameAnalysis.moves.split(" ").forEach(function(e){o.push(n.fen()),n.move(e)}),n.history({verbose:!0}).forEach(function(e,n){if(r.gameAnalysis.analysis[n]&&r.gameAnalysis.analysis[n].judgment){var t=r.gameAnalysis.analysis[n].best;r.gameAnalysis.analysis[n].move=e,r.gameAnalysis.analysis[n].halfMove=n+1,r.gameAnalysis.analysis[n].fen=o[n],r.gameAnalysis.analysis[n].best={from:t.substring(0,2),to:t.substring(2,4)},r.gameAnalysis.analysis[n].speed=r.gameAnalysis.speed,r.gameAnalysis.analysis[n].id=r.gameAnalysis.id}});var t=this.gameAnalysis.players.white.user,i=t&&t.id==e?"w":"b";return this.gameAnalysis.analysis=this.gameAnalysis.analysis.filter(function(e){return e.judgment}).filter(function(e){return e.move.color==i}).map(function(e){return new s.Puzzle(e,r.gameAnalysis)})},e}();t.Analysis=r},{"./puzzle":25,"chess.js":1}],21:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.puzzles=[],this.element=e}return e.prototype.setPuzzles=function(e){this.puzzles=e},e.prototype.redraw=function(){this.render(this.puzzles)},e.prototype.render=function(e){document.write("<pre>"),e.forEach(function(e){document.write(e.render().replace(/\n/g,"\r\n")),document.write("\n\n")}),document.write("</pre>")},e}();t.Boards=r},{}],22:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("chess.js"),o=e("./util");t.colour=function(t){return function(e){var n=new r.Chess(e.analysis.fen);return""===t||o.toColor(n)===t}},t.severity=function(n){return function(e){return""===n||e.analysis.judgment.name===n}},t.phase=function n(t){return function(e){return""===t||("Opening"==t?e.analysis.halfMove<20:"Endgame"===t?e.analysis.fen.replace(/ .*$/,"").replace(/[0-9 pP-]/g,"").length<=13:!n("Opening")(e)&&!n("Endgame")(e))}},t.timecontrol=function(n){return function(e){return""===n||e.analysis.speed===n}}},{"./util":26,"chess.js":1}],23:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("oboe"),r=function(){function e(e){this.url=e}return e.prototype.games=function(e,n,t,r){var o=[];i({method:"GET",url:this.url+"/games/export/"+e+"?max="+n+"&perfType=ultraBullet,bullet,blitz,rapid,classical&analysed=true&evals=true&moves=true&opening=true",headers:{Accept:"application/x-ndjson"}}).node("!",function(e){o.push(e),t(e)}).on("end",function(e){r(o)}).fail(function(e){console.error(JSON.stringify(e))})},e}();t.LichessApi=r},{oboe:19}],24:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./lichessApi");t.LichessApi=r.LichessApi;var o=e("./boards");t.Boards=o.Boards;var i=e("./analysis");t.Analysis=i.Analysis;var a=e("./filters");t.colour=a.colour,t.severity=a.severity,t.phase=a.phase,t.timecontrol=a.timecontrol},{"./analysis":20,"./boards":21,"./filters":22,"./lichessApi":23}],25:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=e("chess.js"),o=e("chessground"),p=e("./util"),r=function(){function e(e,n){var t=this;this.runUnit=function(e){var n=e.elm;n.className="cg-board-wrap",t.run(n)},this.analysis=e,this.chess=new d.Chess(this.analysis.fen),this.config=this.initialiseConfig(),this.status="",this.game=n}return e.prototype.initialiseConfig=function(){var e=p.toColor(this.chess);return{orientation:e,turnColor:e,fen:this.analysis.fen,movable:{color:e,free:!1,dests:p.toDests(this.chess)}}},e.prototype.pathFromStatus=function(e){return""==this.status?e:e+"."+this.status},e.prototype.render=function(){return this.url(this.analysis,this.game)},e.prototype.url=function(e,n){console.log(e);var t=new d.Chess(e.fen),r=p.toColor(t),o=parseInt(e.fen.match(/\d+$/)[0]),i=e.variation.split(" ");i.forEach(function(e){t.move(e)}),t.header("White",n.players.white.user.name),t.header("Black",n.players.black.user.name),t.header("WhiteElo",n.players.white.rating.toString()),t.header("BlackElo",n.players.black.rating.toString()),t.header("Event","https://lichess.org/"+e.id+"/"+r+"#"+(e.halfMove-1));var a=new Date(n.createdAt),s=a.getFullYear()+"."+(a.getMonth()+1)+"."+a.getDate();t.header("Date",s);var u=t.pgn(),c=i[0],l=o+". "+c,f=o+". "+c+" { blunder: "+(e.eval||e.mate)+"} ("+o+". "+e.move.san+") "+o+"... ";return u=u.replace(l,f)+" *",console.log("pgn___",u),u},e.prototype.run=function(e){var t=this,r=o.Chessground(e,this.config);return this.originalMove(r),r.set({movable:{events:{after:function(e,n){t.moveAndResult(r,e,n)}}},events:{select:function(e){t.originalMove(r)}}}),r},e.prototype.originalMove=function(e){e.set({drawable:{shapes:[this.arrow(this.analysis.move,"red")]}})},e.prototype.moveAndResult=function(e,n,t){this.chess.move({from:n,to:t}),e.set({turnColor:p.toColor(this.chess),movable:{color:p.toColor(this.chess),dests:p.toDests(this.chess)},drawable:{shapes:[{orig:n,dest:t,brush:"yellow"},this.arrow(this.analysis.move,"red"),this.arrow(this.analysis.best,"green")]}})},e.prototype.arrow=function(e,n){return{orig:e.from,dest:e.to,brush:n}},e}();t.Puzzle=r},{"./util":26,"chess.js":1,chessground:5}],26:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toDests=function(t){var r={};return t.SQUARES.forEach(function(e){var n=t.moves({square:e,verbose:!0});n.length&&(r[e]=n.map(function(e){return e.to}))}),r},t.toColor=function(e){return"w"===e.turn()?"white":"black"}},{}]},{},[24])(24)});