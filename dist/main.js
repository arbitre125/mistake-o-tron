!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bundle=n()}}(function(){return function o(u,a,f){function s(e,n){if(!a[e]){if(!u[e]){var r="function"==typeof require&&require;if(!n&&r)return r(e,!0);if(l)return l(e,!0);var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}var i=a[e]={exports:{}};u[e][0].call(i.exports,function(n){return s(u[e][1][n]||n)},i,i.exports,o,u,a,f)}return a[e].exports}for(var l="function"==typeof require&&require,n=0;n<f.length;n++)s(f[n]);return s}({1:[function(n,e,r){var t=function(n){var s="b",l="w",f=-1,b="p",E="n",A="b",w="r",_="q",c="k",t="pnbrqkPNBRQK",e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",h=["1-0","0-1","1/2-1/2","*"],C={b:[16,32,17,15],w:[-16,-32,-17,-15]},S={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},p=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],v=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],d={p:0,n:1,b:2,r:3,q:4,k:5},i={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},I={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},T=7,L=6,O=1,P=0,x={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},g={w:[{square:x.a1,flag:I.QSIDE_CASTLE},{square:x.h1,flag:I.KSIDE_CASTLE}],b:[{square:x.a8,flag:I.QSIDE_CASTLE},{square:x.h8,flag:I.KSIDE_CASTLE}]},R=new Array(128),k={w:f,b:f},N=l,q={w:0,b:0},j=f,y=0,m=1,D=[],U={};function a(){R=new Array(128),k={w:f,b:f},N=l,q={w:0,b:0},j=f,y=0,m=1,D=[],U={},z(B())}function M(){Q(e)}function Q(n){var e=n.split(/\s+/),r=e[0],t=0;if(!K(n).valid)return!1;a();for(var i=0;i<r.length;i++){var o=r.charAt(i);if("/"===o)t+=8;else if(-1!=="0123456789".indexOf(o))t+=parseInt(o,10);else{var u=o<"a"?l:s;W({type:o.toLowerCase(),color:u},an(t)),t++}}return N=e[1],-1<e[2].indexOf("K")&&(q.w|=I.KSIDE_CASTLE),-1<e[2].indexOf("Q")&&(q.w|=I.QSIDE_CASTLE),-1<e[2].indexOf("k")&&(q.b|=I.KSIDE_CASTLE),-1<e[2].indexOf("q")&&(q.b|=I.QSIDE_CASTLE),j="-"===e[3]?f:x[e[3]],y=parseInt(e[4],10),m=parseInt(e[5],10),z(B()),!0}function K(n){var e="No errors.",r="FEN string must contain six space-delimited fields.",t="6th field (move number) must be a positive integer.",i="5th field (half move counter) must be a non-negative integer.",o="4th field (en-passant square) is invalid.",u="3rd field (castling availability) is invalid.",a="2nd field (side to move) is invalid.",f="1st field (piece positions) does not contain 8 '/'-delimited rows.",s="1st field (piece positions) is invalid [consecutive numbers].",l="1st field (piece positions) is invalid [invalid piece].",c="1st field (piece positions) is invalid [row too large].",p="Illegal en-passant square",v=n.split(/\s+/);if(6!==v.length)return{valid:!1,error_number:1,error:r};if(isNaN(v[5])||parseInt(v[5],10)<=0)return{valid:!1,error_number:2,error:t};if(isNaN(v[4])||parseInt(v[4],10)<0)return{valid:!1,error_number:3,error:i};if(!/^(-|[abcdefgh][36])$/.test(v[3]))return{valid:!1,error_number:4,error:o};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(v[2]))return{valid:!1,error_number:5,error:u};if(!/^(w|b)$/.test(v[1]))return{valid:!1,error_number:6,error:a};var h=v[0].split("/");if(8!==h.length)return{valid:!1,error_number:7,error:f};for(var d=0;d<h.length;d++){for(var g=0,y=!1,m=0;m<h[d].length;m++)if(isNaN(h[d][m])){if(!/^[prnbqkPRNBQK]$/.test(h[d][m]))return{valid:!1,error_number:9,error:l};g+=1,y=!1}else{if(y)return{valid:!1,error_number:8,error:s};g+=parseInt(h[d][m],10),y=!0}if(8!==g)return{valid:!1,error_number:10,error:c}}return"3"==v[3][1]&&"w"==v[1]||"6"==v[3][1]&&"b"==v[1]?{valid:!1,error_number:11,error:p}:{valid:!0,error_number:0,error:e}}function B(){for(var n=0,e="",r=x.a8;r<=x.h1;r++){if(null==R[r])n++;else{0<n&&(e+=n,n=0);var t=R[r].color,i=R[r].type;e+=t===l?i.toUpperCase():i.toLowerCase()}r+1&136&&(0<n&&(e+=n),r!==x.h1&&(e+="/"),n=0,r+=8)}var o="";q[l]&I.KSIDE_CASTLE&&(o+="K"),q[l]&I.QSIDE_CASTLE&&(o+="Q"),q[s]&I.KSIDE_CASTLE&&(o+="k"),q[s]&I.QSIDE_CASTLE&&(o+="q"),o=o||"-";var u=j===f?"-":an(j);return[e,N,o,u,y,m].join(" ")}function $(n){for(var e=0;e<n.length;e+=2)"string"==typeof n[e]&&"string"==typeof n[e+1]&&(U[n[e]]=n[e+1]);return U}function z(n){0<D.length||(n!==e?(U.SetUp="1",U.FEN=n):(delete U.SetUp,delete U.FEN))}function o(n){var e=R[x[n]];return e?{type:e.type,color:e.color}:null}function W(n,e){if(!("type"in n&&"color"in n))return!1;if(-1===t.indexOf(n.type.toLowerCase()))return!1;if(!(e in x))return!1;var r=x[e];return(n.type!=c||k[n.color]==f||k[n.color]==r)&&(R[r]={type:n.type,color:n.color},n.type===c&&(k[n.color]=r),z(B()),!0)}function F(n,e,r,t,i){var o={color:N,from:e,to:r,flags:t,piece:n[e].type};return i&&(o.flags|=I.PROMOTION,o.promotion=i),n[r]?o.captured=n[r].type:t&I.EP_CAPTURE&&(o.captured=b),o}function G(n){function e(n,e,r,t,i){if(n[r].type!==b||on(t)!==P&&on(t)!==T)e.push(F(n,r,t,i));else for(var o=[_,w,A,E],u=0,a=o.length;u<a;u++)e.push(F(n,r,t,i,o[u]))}var r=[],t=N,i=fn(t),o={b:O,w:L},u=x.a8,a=x.h1,f=!1,s=!(void 0!==n&&"legal"in n)||n.legal;if(void 0!==n&&"square"in n){if(!(n.square in x))return[];u=a=x[n.square],f=!0}for(var l=u;l<=a;l++)if(136&l)l+=7;else{var c=R[l];if(null!=c&&c.color===t)if(c.type===b){var p=l+C[t][0];if(null==R[p]){e(R,r,l,p,I.NORMAL);p=l+C[t][1];o[t]===on(l)&&null==R[p]&&e(R,r,l,p,I.BIG_PAWN)}for(v=2;v<4;v++){136&(p=l+C[t][v])||(null!=R[p]&&R[p].color===i?e(R,r,l,p,I.CAPTURE):p===j&&e(R,r,l,j,I.EP_CAPTURE))}}else for(var v=0,h=S[c.type].length;v<h;v++){var d=S[c.type][v];for(p=l;!(136&(p+=d));){if(null!=R[p]){if(R[p].color===t)break;e(R,r,l,p,I.CAPTURE);break}if(e(R,r,l,p,I.NORMAL),"n"===c.type||"k"===c.type)break}}}if(!f||a===k[t]){if(q[t]&I.KSIDE_CASTLE){var g=(y=k[t])+2;null!=R[y+1]||null!=R[g]||Z(i,k[t])||Z(i,y+1)||Z(i,g)||e(R,r,k[t],g,I.KSIDE_CASTLE)}if(q[t]&I.QSIDE_CASTLE){var y;g=(y=k[t])-2;null!=R[y-1]||null!=R[y-2]||null!=R[y-3]||Z(i,k[t])||Z(i,y-1)||Z(i,g)||e(R,r,k[t],g,I.QSIDE_CASTLE)}}if(!s)return r;var m=[];for(l=0,h=r.length;l<h;l++)en(r[l]),J(t)||m.push(r[l]),rn();return m}function H(n,e){var r="";if(n.flags&I.KSIDE_CASTLE)r="O-O";else if(n.flags&I.QSIDE_CASTLE)r="O-O-O";else{var t=function(n,e){for(var r=G({legal:!e}),t=n.from,i=n.to,o=n.piece,u=0,a=0,f=0,s=0,l=r.length;s<l;s++){var c=r[s].from,p=r[s].to,v=r[s].piece;o===v&&t!==c&&i===p&&(u++,on(t)===on(c)&&a++,un(t)===un(c)&&f++)}if(0<u)return 0<a&&0<f?an(t):0<f?an(t).charAt(1):an(t).charAt(0);return""}(n,e);n.piece!==b&&(r+=n.piece.toUpperCase()+t),n.flags&(I.CAPTURE|I.EP_CAPTURE)&&(n.piece===b&&(r+=an(n.from)[0]),r+="x"),r+=an(n.to),n.flags&I.PROMOTION&&(r+="="+n.promotion.toUpperCase())}return en(n),u()&&(Y()?r+="#":r+="+"),rn(),r}function X(n){return n.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Z(n,e){for(var r=x.a8;r<=x.h1;r++)if(136&r)r+=7;else if(null!=R[r]&&R[r].color===n){var t=R[r],i=r-e,o=i+119;if(p[o]&1<<d[t.type]){if(t.type===b){if(0<i){if(t.color===l)return!0}else if(t.color===s)return!0;continue}if("n"===t.type||"k"===t.type)return!0;for(var u=v[o],a=r+u,f=!1;a!==e;){if(null!=R[a]){f=!0;break}a+=u}if(!f)return!0}}return!1}function J(n){return Z(fn(n),k[n])}function u(){return J(N)}function Y(){return u()&&0===G().length}function r(){return!u()&&0===G().length}function V(){for(var n={},e=[],r=0,t=0,i=x.a8;i<=x.h1;i++)if(t=(t+1)%2,136&i)i+=7;else{var o=R[i];o&&(n[o.type]=o.type in n?n[o.type]+1:1,o.type===A&&e.push(t),r++)}if(2===r)return!0;if(3===r&&(1===n[A]||1===n[E]))return!0;if(r===n[A]+2){var u=0,a=e.length;for(i=0;i<a;i++)u+=e[i];if(0===u||u===a)return!0}return!1}function nn(){for(var n=[],e={},r=!1;;){var t=rn();if(!t)break;n.push(t)}for(;;){var i=B().split(" ").slice(0,4).join(" ");if(e[i]=i in e?e[i]+1:1,3<=e[i]&&(r=!0),!n.length)break;en(n.pop())}return r}function en(n){var e,r=N,t=fn(r);if(e=n,D.push({move:e,kings:{b:k.b,w:k.w},turn:N,castling:{b:q.b,w:q.w},ep_square:j,half_moves:y,move_number:m}),R[n.to]=R[n.from],R[n.from]=null,n.flags&I.EP_CAPTURE&&(N===s?R[n.to-16]=null:R[n.to+16]=null),n.flags&I.PROMOTION&&(R[n.to]={type:n.promotion,color:r}),R[n.to].type===c){if(k[R[n.to].color]=n.to,n.flags&I.KSIDE_CASTLE){var i=n.to-1,o=n.to+1;R[i]=R[o],R[o]=null}else if(n.flags&I.QSIDE_CASTLE){i=n.to+1,o=n.to-2;R[i]=R[o],R[o]=null}q[r]=""}if(q[r])for(var u=0,a=g[r].length;u<a;u++)if(n.from===g[r][u].square&&q[r]&g[r][u].flag){q[r]^=g[r][u].flag;break}if(q[t])for(u=0,a=g[t].length;u<a;u++)if(n.to===g[t][u].square&&q[t]&g[t][u].flag){q[t]^=g[t][u].flag;break}j=n.flags&I.BIG_PAWN?"b"===N?n.to-16:n.to+16:f,n.piece===b?y=0:n.flags&(I.CAPTURE|I.EP_CAPTURE)?y=0:y++,N===s&&m++,N=fn(N)}function rn(){var n=D.pop();if(null==n)return null;var e=n.move;k=n.kings,N=n.turn,q=n.castling,j=n.ep_square,y=n.half_moves,m=n.move_number;var r,t,i=N,o=fn(N);if(R[e.from]=R[e.to],R[e.from].type=e.piece,R[e.to]=null,e.flags&I.CAPTURE)R[e.to]={type:e.captured,color:o};else if(e.flags&I.EP_CAPTURE){var u;u=i===s?e.to-16:e.to+16,R[u]={type:b,color:o}}e.flags&(I.KSIDE_CASTLE|I.QSIDE_CASTLE)&&(e.flags&I.KSIDE_CASTLE?(r=e.to+1,t=e.to-1):e.flags&I.QSIDE_CASTLE&&(r=e.to-2,t=e.to+1),R[r]=R[t],R[t]=null);return e}function tn(n,e){var r=X(n);if(e){var t=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(t)var i=t[1],o=t[2],u=t[3],a=t[4]}for(var f=G(),s=0,l=f.length;s<l;s++){if(r===X(H(f[s]))||e&&r===X(H(f[s],!0)))return f[s];if(t&&(!i||i.toLowerCase()==f[s].piece)&&x[o]==f[s].from&&x[u]==f[s].to&&(!a||a.toLowerCase()==f[s].promotion))return f[s]}return null}function on(n){return n>>4}function un(n){return 15&n}function an(n){var e=un(n),r=on(n);return"abcdefgh".substring(e,e+1)+"87654321".substring(r,r+1)}function fn(n){return n===l?s:l}function sn(n){var e=function n(e){var r=e instanceof Array?[]:{};for(var t in e)r[t]="object"==typeof t?n(e[t]):e[t];return r}(n);e.san=H(e,!1),e.to=an(e.to),e.from=an(e.from);var r="";for(var t in I)I[t]&e.flags&&(r+=i[t]);return e.flags=r,e}function ln(n){return n.replace(/^\s+|\s+$/g,"")}return Q(void 0===n?e:n),{WHITE:l,BLACK:s,PAWN:b,KNIGHT:E,BISHOP:A,ROOK:w,QUEEN:_,KING:c,SQUARES:function(){for(var n=[],e=x.a8;e<=x.h1;e++)136&e?e+=7:n.push(an(e));return n}(),FLAGS:i,load:function(n){return Q(n)},reset:function(){return M()},moves:function(n){for(var e=G(n),r=[],t=0,i=e.length;t<i;t++)void 0!==n&&"verbose"in n&&n.verbose?r.push(sn(e[t])):r.push(H(e[t],!1));return r},in_check:function(){return u()},in_checkmate:function(){return Y()},in_stalemate:function(){return r()},in_draw:function(){return 100<=y||r()||V()||nn()},insufficient_material:function(){return V()},in_threefold_repetition:function(){return nn()},game_over:function(){return 100<=y||Y()||r()||V()||nn()},validate_fen:function(n){return K(n)},fen:function(){return B()},pgn:function(n){var e="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\n",r="object"==typeof n&&"number"==typeof n.max_width?n.max_width:0,t=[],i=!1;for(var o in U)t.push("["+o+' "'+U[o]+'"]'+e),i=!0;i&&D.length&&t.push(e);for(var u=[];0<D.length;)u.push(rn());for(var a=[],f="";0<u.length;){var s=u.pop();D.length||"b"!==s.color?"w"===s.color&&(f.length&&a.push(f),f=m+"."):f=m+". ...",f=f+" "+H(s,!1),en(s)}if(f.length&&a.push(f),void 0!==U.Result&&a.push(U.Result),0===r)return t.join("")+a.join(" ");var l=0;for(o=0;o<a.length;o++)l+a[o].length>r&&0!==o?(" "===t[t.length-1]&&t.pop(),t.push(e),l=0):0!==o&&(t.push(" "),l++),t.push(a[o]),l+=a[o].length;return t.join("")},load_pgn:function(n,e){var r=void 0!==e&&"sloppy"in e&&e.sloppy;function f(n){return n.replace(/\\/g,"\\")}var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",i=new RegExp("^(\\[(.|"+f(t)+")*\\])("+f(t)+")*1.("+f(t)+"|.)*$","g"),o=n.replace(i,"$1");"["!==o[0]&&(o=""),M();var u=function(n,e){for(var r="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",t={},i=n.split(new RegExp(f(r))),o="",u="",a=0;a<i.length;a++)o=i[a].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),u=i[a].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),0<ln(o).length&&(t[o]=u);return t}(o,e);for(var a in u)$([a,u[a]]);if("1"===u.SetUp&&!("FEN"in u&&Q(u.FEN)))return!1;var s=n.replace(o,"").replace(new RegExp(f(t),"g")," ");s=s.replace(/(\{[^}]+\})+?/g,"");for(var l=/(\([^\(\)]+\))+?/g;l.test(s);)s=s.replace(l,"");var c=ln(s=(s=(s=s.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));c=c.join(",").replace(/,,+/g,",").split(",");for(var p="",v=0;v<c.length-1;v++){if(null==(p=tn(c[v],r)))return!1;en(p)}if(p=c[c.length-1],-1<h.indexOf(p))(function(n){for(var e in n)return!0;return!1})(U)&&void 0===U.Result&&$(["Result",p]);else{if(null==(p=tn(p,r)))return!1;en(p)}return!0},header:function(){return $(arguments)},ascii:function(){return function(){for(var n="   +------------------------+\n",e=x.a8;e<=x.h1;e++){if(0===un(e)&&(n+=" "+"87654321"[on(e)]+" |"),null==R[e])n+=" . ";else{var r=R[e].type;n+=" "+(R[e].color===l?r.toUpperCase():r.toLowerCase())+" "}e+1&136&&(n+="|\n",e+=8)}return n+="   +------------------------+\n",n+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return N},move:function(n,e){var r=void 0!==e&&"sloppy"in e&&e.sloppy,t=null;if("string"==typeof n)t=tn(n,r);else if("object"==typeof n)for(var i=G(),o=0,u=i.length;o<u;o++)if(!(n.from!==an(i[o].from)||n.to!==an(i[o].to)||"promotion"in i[o]&&n.promotion!==i[o].promotion)){t=i[o];break}if(!t)return null;var a=sn(t);return en(t),a},undo:function(){var n=rn();return n?sn(n):null},clear:function(){return a()},put:function(n,e){return W(n,e)},get:function(n){return o(n)},remove:function(n){return r=o(e=n),R[x[e]]=null,r&&r.type===c&&(k[r.color]=f),z(B()),r;var e,r},perft:function(n){return function n(e){for(var r=G({legal:!1}),t=0,i=N,o=0,u=r.length;o<u;o++)en(r[o]),J(i)||(0<e-1?t+=n(e-1):t++),rn();return t}(n)},square_color:function(n){if(n in x){var e=x[n];return(on(e)+un(e))%2==0?"light":"dark"}return null},history:function(n){for(var e=[],r=[],t=(void 0!==n&&"verbose"in n&&n.verbose);0<D.length;)e.push(rn());for(;0<e.length;){var i=e.pop();t?r.push(sn(i)):r.push(H(i)),en(i)}return r}}};void 0!==r&&(r.Chess=t)},{}],2:[function(n,bn,En){!function(h,r,c,H,f,X){var d=v(function(r,t){var i=t.length;return v(function(n){for(var e=0;e<n.length;e++)t[i+e]=n[e];return t.length=i+n.length,r.apply(this,t)})});v(function(n){var e=O(n);function r(n,e){return[p(n,e)]}return v(function(n){return x(r,n,e)[0]})});function g(n,e){return function(){return n.call(this,e.apply(this,arguments))}}function t(e){return function(n){return n[e]}}var y=v(function(t){return v(function(n){for(var e,r=0;r<w(t);r++)if(e=p(n,t[r]))return e})});function p(n,e){return e.apply(X,n)}function v(e){var r=e.length-1,t=c.prototype.slice;if(0==r)return function(){return e.call(this,t.call(arguments))};if(1==r)return function(){return e.call(this,arguments[0],t.call(arguments,1))};var i=c(e.length);return function(){for(var n=0;n<r;n++)i[n]=arguments[n];return i[r]=t.call(arguments,r),e.apply(this,i)}}function m(e,r){return function(n){return e(n)&&r(n)}}function b(){}function E(){return!0}function A(n,e){return e&&e.constructor===n}var w=t("length"),_=d(A,String);function C(n){return n!==X}function S(n,e){return e instanceof r&&function n(e,r){return!r||e(T(r))&&n(e,L(r))}(function(n){return n in e},n)}function I(n,e){return[n,e]}var i=null,T=t(0),L=t(1);function O(n){return R(n.reduce((r=I,function(n,e){return r(e,n)}),i));var r}var P=v(O);function a(n){return x(function(n,e){return n.unshift(e),n},[],n)}function s(n,e){return e?I(n(T(e)),s(n,L(e))):i}function x(n,e,r){return r?n(x(n,e,L(r)),T(r)):e}function l(n,t,e){return function n(e,r){return e?t(T(e))?(r(T(e)),L(e)):I(T(e),n(L(e),r)):i}(n,e||b)}function R(n){return function n(e,r){return e?n(L(e),I(T(e),r)):r}(n,i)}function u(n){"use strict";var o,u,a,f=n(ln).emit,s=n(cn).emit,l=n(pn).emit,e=n(rn).emit,c=65536,p=/[\\"\n]/g,r=0,v=r++,h=r++,d=r++,g=r++,y=r++,m=r++,b=r++,E=r++,A=r++,w=r++,_=r++,C=r++,S=r++,I=r++,T=r++,L=r++,O=r++,P=r++,x=r++,R=r++,k=c,N=X,q="",j=!1,D=!1,U=v,M=[],Q=null,K=0,B=0,$=0,z=0,W=1;function F(n){N!==X&&(s(N),l(),N=X),o=H(n+"\nLn: "+W+"\nCol: "+z+"\nChr: "+u),e(vn(X,X,o))}function G(n){return"\r"==n||"\n"==n||" "==n||"\t"==n}n(an).on(function(n){if(o)return;if(D)return F("Cannot write after close");var e=0;u=n[0];for(;u&&(0<e&&(a=u),u=n[e++]);)switch($++,"\n"==u?(W++,z=0):z++,U){case v:if("{"===u)U=d;else if("["===u)U=y;else if(!G(u))return F("Non-whitespace before {[.");continue;case E:case d:if(G(u))continue;if(U===E)M.push(A);else{if("}"===u){s({}),l(),U=M.pop()||h;continue}M.push(g)}if('"'!==u)return F('Malformed object key should start with " ');U=b;continue;case A:case g:if(G(u))continue;if(":"===u)U===g?(M.push(g),N!==X&&(s({}),f(N),N=X),B++):N!==X&&(f(N),N=X),U=h;else if("}"===u)N!==X&&(s(N),l(),N=X),l(),B--,U=M.pop()||h;else{if(","!==u)return F("Bad object");U===g&&M.push(g),N!==X&&(s(N),l(),N=X),U=E}continue;case y:case h:if(G(u))continue;if(U===y){if(s([]),B++,U=h,"]"===u){l(),B--,U=M.pop()||h;continue}M.push(m)}if('"'===u)U=b;else if("{"===u)U=d;else if("["===u)U=y;else if("t"===u)U=w;else if("f"===u)U=S;else if("n"===u)U=O;else if("-"===u)q+=u;else if("0"===u)q+=u,U=20;else{if(-1==="123456789".indexOf(u))return F("Bad value");q+=u,U=20}continue;case m:if(","===u)M.push(m),N!==X&&(s(N),l(),N=X),U=h;else{if("]"!==u){if(G(u))continue;return F("Bad array")}N!==X&&(s(N),l(),N=X),l(),B--,U=M.pop()||h}continue;case b:N===X&&(N="");var r=e-1;n:for(;;){for(;0<K;)if(Q+=u,u=n.charAt(e++),4===K?(N+=String.fromCharCode(parseInt(Q,16)),K=0,r=e-1):K++,!u)break n;if('"'===u&&!j){U=M.pop()||h,N+=n.substring(r,e-1);break}if(!("\\"!==u||j||(j=!0,N+=n.substring(r,e-1),u=n.charAt(e++))))break;if(j){if(j=!1,"n"===u?N+="\n":"r"===u?N+="\r":"t"===u?N+="\t":"f"===u?N+="\f":"b"===u?N+="\b":"u"===u?(K=1,Q=""):N+=u,u=n.charAt(e++),r=e-1,u)continue;break}p.lastIndex=e;var t=p.exec(n);if(!t){e=n.length+1,N+=n.substring(r,e-1);break}if(e=t.index+1,!(u=n.charAt(t.index))){N+=n.substring(r,e-1);break}}continue;case w:if(!u)continue;if("r"!==u)return F("Invalid true started with t"+u);U=_;continue;case _:if(!u)continue;if("u"!==u)return F("Invalid true started with tr"+u);U=C;continue;case C:if(!u)continue;if("e"!==u)return F("Invalid true started with tru"+u);s(!0),l(),U=M.pop()||h;continue;case S:if(!u)continue;if("a"!==u)return F("Invalid false started with f"+u);U=I;continue;case I:if(!u)continue;if("l"!==u)return F("Invalid false started with fa"+u);U=T;continue;case T:if(!u)continue;if("s"!==u)return F("Invalid false started with fal"+u);U=L;continue;case L:if(!u)continue;if("e"!==u)return F("Invalid false started with fals"+u);s(!1),l(),U=M.pop()||h;continue;case O:if(!u)continue;if("u"!==u)return F("Invalid null started with n"+u);U=P;continue;case P:if(!u)continue;if("l"!==u)return F("Invalid null started with nu"+u);U=x;continue;case x:if(!u)continue;if("l"!==u)return F("Invalid null started with nul"+u);s(null),l(),U=M.pop()||h;continue;case R:if("."!==u)return F("Leading zero not followed by .");q+=u,U=20;continue;case 20:if(-1!=="0123456789".indexOf(u))q+=u;else if("."===u){if(-1!==q.indexOf("."))return F("Invalid number has two dots");q+=u}else if("e"===u||"E"===u){if(-1!==q.indexOf("e")||-1!==q.indexOf("E"))return F("Invalid number has two exponential");q+=u}else if("+"===u||"-"===u){if("e"!==a&&"E"!==a)return F("Invalid symbol in number");q+=u}else q&&(s(parseFloat(q)),l(),q=""),e--,U=M.pop()||h;continue;default:return F("Unknown state: "+U)}k<=$&&(i=0,N!==X&&N.length>c&&(F("Max buffer length exceeded: textNode"),i=Math.max(i,N.length)),q.length>c&&(F("Max buffer length exceeded: numberNode"),i=Math.max(i,q.length)),k=c-i+$);var i}),n(fn).on(function(){if(U==v)return s({}),l(),void(D=!0);U===h&&0===B||F("Unexpected end");N!==X&&(s(N),l(),N=X);D=!0})}var n,e,o,k,N,q,j,D,U,M,Q,K=(n=v(function(n){return n.unshift(/^/),(e=RegExp(n.map(t("source")).join(""))).exec.bind(e);var e}),k=n(e=/(\$?)/,/([\w-_]+|\*)/,o=/(?:{([\w ]*?)})?/),N=n(e,/\["([^"]+)"\]/,o),q=n(e,/\[(\d+|\*)\]/,o),j=n(e,/()/,/{([\w ]*?)}/),D=n(/\.\./),U=n(/\./),M=n(e,/!/),Q=n(/$/),function(n){return n(y(k,N,q,j),D,U,M,Q)});function B(n,e){return{key:n,node:e}}var $=t("key"),z=t("node"),W={};function F(n){var i=n(Y).emit,e=n(V).emit,f=n(on).emit,r=n(tn).emit;function s(n,e,r){z(T(n))[e]=r}function l(n,e,r){n&&s(n,e,r);var t=I(B(e,r),n);return i(t),t}var t={};return t[cn]=function(n,e){if(!n)return f(e),l(n,W,e);var r,t,i,o=(t=e,i=z(T(r=n)),A(c,i)?l(r,w(i),t):r),u=L(o),a=$(T(o));return s(u,a,e),I(B(a,e),u)},t[pn]=function(n){return e(n),L(n)||r(z(T(n)))},t[ln]=l,t}var G=K(function(n,e,r,t,i){var o=g($,T),u=g(z,T);function a(n,e){return!!e[1]?m(n,T):n}function f(n){if(n==E)return E;return m(function(n){return o(n)!=W},g(n,L))}function s(){return function(n){return o(n)==W}}function l(n,e,r,t,i){var o,u=n(r);if(u){var a=(o=u,x(function(n,e){return e(n,o)},t,e));return i(r.substr(w(u[0])),a)}}function c(n,e){return d(l,n,e)}var p=y(c(n,P(a,function(n,e){var r=e[3];return r?m(g(d(S,O(r.split(/\W+/))),u),n):n},function(n,e){var r=e[2];return m(r&&"*"!=r?function(n){return o(n)==r}:E,n)},f)),c(e,P(function(n){if(n==E)return E;var e=s(),r=n,t=f(function(n){return i(n)}),i=y(e,r,t);return i})),c(r,P()),c(t,P(a,s)),c(i,P(function(r){return function(n){var e=r(n);return!0===e?T(n):e}})),function(n){throw H('"'+n+'" could not be tokenised')});function v(n,e){return e}function h(n,e){return p(n,e,n?h:v)}return function(e){try{return h(e,E)}catch(n){throw H('Could not compile "'+e+'" because '+n.message)}}});function Z(t,i,r){var o,u;function a(e){return function(n){return n.id==e}}return{on:function(n,e){var r={listener:n,id:e||n};return i&&i.emit(t,n,r.id),o=I(r,o),u=I(n,u),this},emit:function(){!function n(e,r){e&&(T(e).apply(null,r),n(L(e),r))}(u,arguments)},un:function(n){var e;o=l(o,a(n),function(n){e=n}),e&&(u=l(u,function(n){return n==e.listener}),r&&r.emit(t,e.listener,e.id))},listeners:function(){return u},hasListener:function(n){return C(function n(e,r){return r&&(e(T(r))?T(r):n(e,L(r)))}(n?a(n):E,o))}}}var J=1,Y=J++,V=J++,nn=J++,en=J++,rn="fail",tn=J++,on=J++,un="start",an="data",fn="end",sn=J++,ln=J++,cn=J++,pn=J++;function vn(n,e,r){try{var t=f.parse(e)}catch(n){}return{statusCode:n,body:e,jsonBody:t,thrown:r}}function hn(t,i){var o={node:t(V),path:t(Y)};function u(e,r,o){var u=t(e).emit;r.on(function(n){var e,r,t,i=o(n);!1!==i&&(e=u,r=z(i),t=R(n),e(r,a(L(s($,t))),a(s(z,t))))},e),t("removeListener").on(function(n){n==e&&(t(n).listeners()||r.un(e))})}t("newListener").on(function(n){var e=/(node|path):(.*)/.exec(n);if(e){var r=o[e[1]];r.hasListener(n)||u(n,r,i(e[2]))}})}function dn(o,n){var i,u=/^(node|path):./,a=o(tn),f=o(en).emit,s=o(nn).emit,e=v(function(n,e){if(i[n])p(e,i[n]);else{var r=o(n),t=e[0];u.test(n)?l(r,t):r.on(t)}return i});function l(e,n,r){r=r||n;var t=c(n);return e.on(function(){var n=!1;i.forget=function(){n=!0},p(arguments,t),delete i.forget,n&&e.un(r)},r),i}function c(n){return function(){try{return n.apply(i,arguments)}catch(n){setTimeout(function(){throw new H(n.message)})}}}function t(n,e,r){var t,i;"node"==n?(i=r,t=function(){var n=i.apply(this,arguments);C(n)&&(n==mn.drop?f():s(n))}):t=r,l(o(n+":"+e),t,r)}function r(n,e,r){return _(e)?t(n,e,r):function(n,e){for(var r in e)t(n,r,e[r])}(n,e),i}return o(on).on(function(n){var e;i.root=(e=n,function(){return e})}),o(un).on(function(n,e){i.header=function(n){return n?e[n]:e}}),i={on:e,addListener:e,removeListener:function(n,e,r){if("done"==n)a.un(e);else if("node"==n||"path"==n)o.un(n+":"+e,r);else{var t=e;o(n).un(t)}return i},emit:o.emit,node:d(r,"node"),path:d(r,"path"),done:d(l,a),start:d(function(n,e){return o(n).on(c(e),e),i},un),fail:o(rn).on,abort:o(sn).emit,header:b,root:b,source:n}}function gn(n,e,r,t,i){var o=function(){var e={},r=i("newListener"),t=i("removeListener");function i(n){return e[n]=Z(n,r,t)}function o(n){return e[n]||i(n)}return["emit","on","un"].forEach(function(r){o[r]=v(function(n,e){p(e,o(n)[r])})}),o}();return e&&function(e,t,n,r,i,o,u){"use strict";var a,f=e(an).emit,s=e(rn).emit,l=0,c=!0;function p(){var n=t.responseText,e=n.substr(l);e&&f(e),l=w(n)}e(sn).on(function(){t.onreadystatechange=null,t.abort()}),"onprogress"in t&&(t.onprogress=p),t.onreadystatechange=function(){function n(){try{c&&e(un).emit(t.status,(n=t.getAllResponseHeaders(),r={},n&&n.split("\r\n").forEach(function(n){var e=n.indexOf(": ");r[n.substring(0,e)]=n.substring(e+2)}),r)),c=!1}catch(n){}var n,r}switch(t.readyState){case 2:case 3:return n();case 4:n(),2==String(t.status)[0]?(p(),e(fn).emit()):s(vn(t.status,t.responseText))}};try{for(var v in t.open(n,r,!0),o)t.setRequestHeader(v,o[v]);(function(e,n){function r(n){return n.port||{"http:":80,"https:":443}[n.protocol||e.protocol]}return!!(n.protocol&&n.protocol!=e.protocol||n.host&&n.host!=e.host||n.host&&r(n)!=r(e))})(h.location,{protocol:(a=/(\w+:)?(?:\/\/)([\w.-]+)?(?::(\d+))?\/?/.exec(r)||[])[1]||"",host:a[2]||"",port:a[3]||""})||t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.withCredentials=u,t.send(i)}catch(n){h.setTimeout(d(s,vn(X,X,n)),0)}}(o,new XMLHttpRequest,n,e,r,t,i),u(o),function(e,r){"use strict";var i,t={};function n(e){return function(n){i=e(i,n)}}for(var o in r)e(o).on(n(r[o]),t);e(nn).on(function(n){var e=T(i),r=$(e),t=L(i);t&&(z(T(t))[r]=n)}),e(en).on(function(){var n=T(i),e=$(n),r=L(i);r&&delete z(T(r))[e]}),e(sn).on(function(){for(var n in r)e(n).un(t)})}(o,F(o)),hn(o,G),dn(o,e)}function yn(n,e,r,t,i,o,u){return i=i?f.parse(f.stringify(i)):{},t?(_(t)||(t=f.stringify(t),i["Content-Type"]=i["Content-Type"]||"application/json"),i["Content-Length"]=i["Content-Length"]||t.length):t=null,n(r||"GET",(a=e,!1===u&&(-1==a.indexOf("?")?a+="?":a+="&",a+="_="+(new Date).getTime()),a),t,i,o||!1);var a}function mn(n){var e=P("resume","pause","pipe"),r=d(S,e);return n?r(n)||_(n)?yn(gn,n):yn(gn,n.url,n.method,n.body,n.headers,n.withCredentials,n.cached):gn()}mn.drop=function(){return mn.drop},"object"==typeof En?bn.exports=mn:h.oboe=mn}(function(){try{return window}catch(n){return self}}(),Object,Array,Error,JSON)},{}],3:[function(n,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=n("chess.js"),a=n("./puzzle"),t=function(){function n(n){this.gameAnalysis=n}return n.prototype.puzzles=function(n){var t=this,e=new u.Chess,i=[];this.gameAnalysis.moves.split(" ").forEach(function(n){i.push(e.fen()),e.move(n)}),e.history({verbose:!0}).forEach(function(n,e){if(t.gameAnalysis.analysis[e]&&t.gameAnalysis.analysis[e].judgment){var r=t.gameAnalysis.analysis[e].best;t.gameAnalysis.analysis[e].move=n,t.gameAnalysis.analysis[e].halfMove=e+1,t.gameAnalysis.analysis[e].fen=i[e],t.gameAnalysis.analysis[e].best={from:r.substring(0,2),to:r.substring(2,4)},t.gameAnalysis.analysis[e].speed=t.gameAnalysis.speed,t.gameAnalysis.analysis[e].id=t.gameAnalysis.id}});var r=this.gameAnalysis.players.white.user,o=r&&r.id==n?"w":"b";return this.gameAnalysis.analysis=this.gameAnalysis.analysis.filter(function(n){return n.judgment}).filter(function(n){return n.move.color==o}).map(function(n){return new a.Puzzle(n,t.gameAnalysis)})},n}();r.Analysis=t},{"./puzzle":7,"chess.js":1}],4:[function(n,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n("chess.js"),i=n("./util");r.colour=function(r){return function(n){var e=new t.Chess(n.analysis.fen);return""===r||i.toColor(e)===r}},r.severity=function(e){return function(n){return""===e||n.analysis.judgment.name===e}},r.phase=function e(r){return function(n){return""===r||("Opening"==r?n.analysis.halfMove<20:"Endgame"===r?n.analysis.fen.replace(/ .*$/,"").replace(/[0-9 pP-]/g,"").length<=13:!e("Opening")(n)&&!e("Endgame")(n))}},r.timecontrol=function(e){return function(n){return""===e||n.analysis.speed===e}}},{"./util":8,"chess.js":1}],5:[function(n,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("oboe"),t=function(){function n(n){this.url=n}return n.prototype.games=function(n,e,r,t){var i=[];o({method:"GET",url:this.url+"/games/export/"+n+"?max="+e+"&perfType=ultraBullet,bullet,blitz,rapid,classical&analysed=true&evals=true&moves=true&opening=true&color=white",headers:{Accept:"application/x-ndjson"}}).node("!",function(n){i.push(n),r(n)}).on("end",function(n){t()}).fail(function(n){console.error(JSON.stringify(n))})},n}();r.LichessApi=t},{oboe:2}],6:[function(n,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n("./lichessApi");r.LichessApi=t.LichessApi;var i=n("./analysis");r.Analysis=i.Analysis;var o=n("./filters");r.colour=o.colour,r.severity=o.severity,r.phase=o.phase,r.timecontrol=o.timecontrol},{"./analysis":3,"./filters":4,"./lichessApi":5}],7:[function(n,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=n("chess.js"),l=n("./util"),t=function(){function n(n,e){this.analysis=n,this.game=e}return n.prototype.render=function(){return this.url(this.analysis,this.game)},n.prototype.url=function(n,e){var r=new s.Chess(n.fen),t=l.toColor(r),i=parseInt(n.fen.match(/\d+$/)[0]),o=n.variation.split(" ");o.forEach(function(n){r.move(n)}),r.header("White",e.players.white.user.name),r.header("Black",e.players.black.user.name),r.header("WhiteElo",e.players.white.rating.toString()),r.header("BlackElo",e.players.black.rating.toString()),r.header("Event","https://lichess.org/"+n.id+"/"+t+"#"+(n.halfMove-1));var u=new Date(e.createdAt),a=u.getFullYear()+"."+(u.getMonth()+1)+"."+u.getDate();r.header("Date",a);var f=r.pgn();o[0];return f+=" *"},n}();r.Puzzle=t},{"./util":8,"chess.js":1}],8:[function(n,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.toDests=function(r){var t={};return r.SQUARES.forEach(function(n){var e=r.moves({square:n,verbose:!0});e.length&&(t[n]=e.map(function(n){return n.to}))}),t},r.toColor=function(n){return"w"===n.turn()?"white":"black"}},{}]},{},[6])(6)});
