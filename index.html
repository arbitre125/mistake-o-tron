<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="assets/chessground.css">
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/examples.css">
</head>

<body>
    <h2>test-o-tron</h2>
    <div class="inputs">
        <p><label>Game History</label></p><br/>Game history is fetched at 10 games per second from <a href="https://lichess.org/api">lichess</a>. The more you ask for the longer it takes.
        <br/> Player:
        <input type="text" id="player" name="player" value="tailuge" onkeydown="pressEnter(event)" />
        <br/> Number of analysed games to fetch:
        <input type="text" name="games" id="games" value="8" onkeydown="pressEnter(event)" />
        <br/>
        <input type="submit" id="Search" value="Fetch data" onclick="search()">
    </div>


    <div class="inputs">
        <p><label>Analysis Filter</label></p><br/> Severity
        <select id="severity">
     <option value="" selected="selected">Any</option>
     <option value="Inaccuracy">Inaccuracy</option>
     <option value="Mistake">Mistake</option>
     <option value="Blunder">Blunder</option>
    </select> Game Phase
        <select id="phase">
     <option value="" selected="selected">Any</option>
     <option value="Opening">Opening</option>
     <option value="Middlegame">Middlegame</option>
     <option value="Endgame">Endgame</option>
    </select> Colour
        <select id="colour">
     <option value="" selected="selected">Any</option>
     <option value="white">White</option>
     <option value="black">Black</option>
    </select> Time control:
        <select id="timecontrol">
  	 <option value="" selected="selected">Any</option>
  	 <option value="classical">Classical</option>
  	 <option value="rapid">Rapid</option>
  	 <option value="blitz">Blitz</option>
  	 <option value="bullet">Bullet</option>
  	 <option value="ultraBullet">UltraBullet</option>
  	 <option value="unlimited">Unlimited</option>
  	 <option value="correspondence">Correspondence</option>
		</select>
        <input type="submit" id="Recompute" value="Recompute" onclick="recompute()">

    </div>

    <div class="inputs">
        <pre id="log"></pre>
    </div>
    <div id="chessground-examples"></div>
    <script src="dist/main.js"></script>
    <script>
        /* global bundle */

        function status(x) {
            document.getElementById("log").innerHTML = x;
        }

        var boards = new bundle.Boards(document.getElementById('chessground-examples'));
        var puzzles = [];

        function search() {
            var api = new bundle.LichessApi("https://lichess.org");
            var all = [];
            puzzles = [];
            var total = document.getElementById('games').value;
            var player = document.getElementById('player').value;
            status("Fetching data...");
            boards.setPuzzles([]);
            api.games(player, total,
                x => {
                    all.push(x);
                    status("Fetching : " + all.length + " of " + total);
                    puzzles = puzzles.concat((new bundle.Analysis(x)).puzzles(player));
                    boards.setPuzzles(filter(puzzles));
                },
                x => {
                    status("Done");
                });
        }

        function filter(puzzles) {
            return puzzles
                .filter(bundle.severity(document.getElementById('severity').value))
                .filter(bundle.timecontrol(document.getElementById('timecontrol').value))
                .filter(bundle.colour(document.getElementById('colour').value))
                .filter(bundle.phase(document.getElementById('phase').value));
        }

        function recompute() {
            boards.setPuzzles(filter(puzzles));
        }

        function pressEnter(event) {
            if (event.keyCode == 13) {
                document.getElementById('Search').click();
            }
        }
    </script>
</body>

</html>
